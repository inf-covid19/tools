{"version":3,"sources":["assets/ufrgs-inf.png","assets/ufrgs.png","constants.ts","hooks/useMetadata.ts","utils/metadata.ts","components/RegionSelector.tsx","components/ExportChart.tsx","components/Editor.tsx","utils/normalizeTimeseries.ts","hooks/useRegionData.ts","hooks/useSeriesColors.ts","hooks/useColorScale.ts","components/CustomizableChart.tsx","components/ChartEditor.tsx","components/ListDescriptor.tsx","assets/logo.svg","components/Loader.tsx","utils/string.ts","components/TrendChart.tsx","hooks/useLastUpdated.ts","components/PredictionsChart.tsx","utils/sammonStress.ts","components/ProjectionsChart.tsx","utils/math.ts","hooks/useQueryString.ts","components/Similarity/Explorer.tsx","App.tsx","components/TrendEditor.tsx","components/PredictionsEditor.tsx","components/ProjectionsEditor.tsx","serviceWorker.ts","index.tsx"],"names":["module","exports","DEFAULT_OPTIONS","chartType","metric","showDataLabels","isCumulative","title","dayInterval","selectedRegions","alignAt","scale","predictionDays","projectionType","epsilon","perplexity","iterations","timeserieSlice","spread","neighbors","minDist","DEFAULT_COUNTRIES","DATA_SOURCES","name","url","PLACE_TYPE_LABEL_MAPPING","state","city","autonomous_community","country","county","nhsr","utla","health_board","lgd","unknown","region","departamento","provincia","province","lower_tier_local_authority","SIMILARITY_API","process","fetchMetadata","a","fetch","response","json","data","useMetadata","useQuery","status","error","useMemo","loading","getByRegionId","metadata","regionId","regionPath","id","split","getRegionPath","regions","key","flag","getFlag","displayName","getNameFromCountry","file","parent","isCountry","get","getNameFromRegion","place_type","getFileByRegionId","replace","geoId","toLowerCase","RegionSelector","value","onChange","multiple","filter","useState","search","setSearch","fromValue","setFromValue","selected","Object","keys","k","groups","arr","entries","flatMap","countryData","map","regionData","text","type","groupBy","r","keyBy","fromOptions","defaultFromOptions","content","icon","length","fuse","Fuse","values","minMatchCharLength","threshold","weight","selectedOptions","Boolean","allOptions","concat","sortBy","result","limit","item","options","o","onSearchChangeHandler","useCallback","debounce","_","searchQuery","setSelected","fromEntries","onChangeHandler","castArray","style","display","marginBottom","marginRight","Header","as","Dropdown","selectOnNavigation","zIndex","header","inline","color","direction","scrolling","Menu","Item","className","onClick","uniq","isEmpty","Flag","group","items","groupName","i","undefined","placeholder","clearable","fluid","selection","defaultTo","first","minCharacters","noResultsMessage","onSearchChange","ExportChart","chart","React","setLoading","fileName","slugify","svg","current","paper","download","dataURI","then","imgURI","series","props","X","s","x","seriesKeyed","seriesNames","forEach","push","csv","d3","SAVED_CHARTS_KEY","DEFAULTS_KEY","Editor","availableOptions","isPredictionChart","defaultsValues","defaults","localStorage","hasOwnProperty","savedChartsJSON","getItem","parsedDefaults","JSON","parse","selectedCountries","getDefaultsValues","savedChart","getSavedCharts","savedCharts","setSavedCharts","chartRef","useRef","setOptions","saved","setSaved","saving","setSaving","useEffect","setItem","stringify","cancelled","setTimeout","setSelectedRegions","opt","includes","Container","Grid","padded","Row","Column","width","Segment","render","height","Form","Field","defaultValue","onBlur","target","Select","label","min","parseInt","disabled","Fragment","parseFloat","Checkbox","toggle","checked","Button","primary","positive","newSavedCharts","omit","index","Card","Image","alt","wrapped","ui","src","Content","Meta","extra","Icon","Group","widths","attached","window","scrollTo","idx","PLACE_TYPE_COLUMN_MAPPING","REGION_CUSTOM_CONFIG","Brazil","columns","cases","parseDate","row","dateColumn","dateFormat","startOfDay","Date","alignTimeseries","timeseries","earliestDate","isBefore","date","d","isAfter","subDays","missingDays","eachDayOfInterval","start","end","slice","cases_daily","deaths","deaths_daily","normalizeTimeseries","timeseriesRaw","orderBy","prevDate","casesColumn","deathsColumn","totalCases","totalDeaths","differenceInDays","missingInterval","missingDate","Number","Math","max","entry","useRegionData","regionIds","cache","sortedRegionIds","queryFn","cachedKeys","uncachedKeys","keysByFile","files","dataByKey","Promise","all","raw","useSeriesColors","sortedSeries","schemeCategory10","input","seed","sum","Array","from","charCodeAt","shade","sin","toMaterialStyle","round","backgroundColor","colorHash","reverse","join","useColorScale","y","maxDomain","minDomain","colorscale","domain","ticks","step","t","ranges","to","rgbToColorString","parseToRgb","foreColor","readableColor","displayNumberFormatter","ordinalFormattter","n","numeral","format","numberFormatter","forwardRef","ref","isIncidence","getPopulation","rest","getValue","alignedData","v","getTime","seriesColors","colorScale","chartOptions","fontFamily","animations","animateGradually","enabled","toolbar","tools","zoom","zoomin","zoomout","pan","reset","colors","tooltip","formatter","xaxis","labels","yaxis","axisTicks","offsetX","axisBorder","isNumber","dataLabels","fontSize","plotOptions","heatmap","justifyContent","alignItems","Loader","active","textAlign","AVAILABLE_OPTIONS","ListDescriptor","children","effectiveChildren","Children","toArray","child","_extends","assign","arguments","source","prototype","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","createElement","fill","fillRule","clipRule","_ref","svgRef","viewBox","ForwardRef","background","titleCase","word","toUpperCase","valueColumn","valueDailyColumn","reduce","minX","POSITIVE_INFINITY","minY","maxX","NEGATIVE_INFINITY","maxY","xScaler","pow","floor","log10","ceil","yScaler","scaledSeries","xTicks","yTicks","xTickAmount","last","yTickAmount","withXScaler","fn","args","invert","withYScaler","grid","lines","show","stroke","curve","shared","intersect","point","w","config","seriesIndex","dataPointIndex","legend","position","tickAmount","offsetY","markers","size","strokeWidth","strokeOpacity","hover","sizeOffset","factor","defaultLastUpdated","subHours","toISOString","fetchRepo","filteredSeries","seriesWithPredictions","serie","dataSinceFirstCase","serieData","isPrediction","nextSeriePredictions","acc","Y","degree","regression","PolynomialRegression","pred","predict","lastDate","predictionSerie","addDays","fActual","fPrediction","F","Ka","K","Ki","predValue","lastMetric","getNextSeriesPrediction","x1","x2","predictions","predictionX1","predictionX2","pointData","annotations","fillColor","opacity","makeMatrix","m","matrix","Matrix","scaleFn","range","j","set","getDistance","b","distanceFn","ml","euclidean","regionDataWithValues","startDate","endDate","avg","sort","mid","median","validSeries","projectionData","cord","projectionOutput","model","TSNE","dim","earlyExaggeration","learningRate","nIter","init","getOutput","embedding","UMAP","nComponents","nNeighbors","fit","sammonStress","projection","stress","rawMatrix","projectionMatrix","rows","dOriginal","getRow","dProjection","getSammonStress","projectionSeries","seriesData","total","subtitle","toFixed","floating","strokeColors","strokeDashArray","useQueryString","history","useHistory","useLocation","params","queryString","setParams","nextParams","similarityOptions","Explorer","regionKey","useParams","query","setQuery","aspect","find","secondary","setSecondary","pathname","generatePath","parsedData","parsedItem","area_km","cluster","days","population","population_density","dataByCluster","regionFilter","currentRegion","selectedKey","resolve","topSimilarData","topSimilarDataStatus","timer","setInterval","queryCache","refetchQueries","force","clearInterval","sortedTopSimilar","maxValue","console","warn","clusterBuddies","secondaryRegion","chartRegions","timelineStats","stats","timeline","firstCase","firstDeath","sinceFirstCase","sinceFirstDeath","regionSelector","maxWidth","margin","padding","gridTemplateColumns","fontWeight","button","basic","compact","setAspect","Subheader","maxHeight","overflow","List","relaxed","href","evt","preventDefault","is_same_cluster","Popup","inverted","trigger","Statistic","horizontal","Value","Label","DiffIndicator","primaryValue","secondaryValue","diff","isHugeDiff","abs","MENU_ITEMS","path","component","pick","isBeta","SimilarityExplorer","App","lastUpdated","useLastUpdated","lastLocation","location","ReactGA","pageview","LogoUFRGS","LogoINF","pointing","match","Link","rel","fns","hostname","initialize","ReactDOM","StrictMode","refetchAllOnWindowFocus","basename","ReactRouterRoute","Route","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.2789dc34.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/ufrgs-inf.1abd8f9e.png\";","module.exports = __webpack_public_path__ + \"static/media/ufrgs.6440c8a1.png\";","export type ScaleType = \"linear\" | \"log\";\nexport type ChartType = \"heatmap\" | \"bar\" | \"area\" | \"line\" | \"scatter\";\nexport type MetricType = \"cases\" | \"deaths\";\nexport type ProjectionType = \"tsne\" | \"umap\";\n\nexport const DEFAULT_OPTIONS = {\n  chartType: \"heatmap\",\n  metric: \"cases\",\n  showDataLabels: false,\n  isCumulative: true,\n  title: \"Timeline Plots of Coronavirus Data\",\n  dayInterval: 30,\n  selectedRegions: {},\n  alignAt: 0,\n  scale: \"log\" as ScaleType,\n  predictionDays: 7,\n  projectionType: \"umap\" as ProjectionType,\n  epsilon: 5,\n  perplexity: 10,\n  iterations: 5000,\n  timeserieSlice: 20,\n  spread: 5,\n  neighbors: 2,\n  minDist: 0.1,\n};\n\nexport const DEFAULT_COUNTRIES = [\n  \"Brazil\",\n  \"United_States_of_America\",\n  \"United_Kingdom\",\n  \"China\",\n  \"Sweden\",\n  \"Spain\",\n  \"Germany\",\n  \"France\",\n  \"Canada\",\n  \"Portugal\",\n  \"Italy\",\n  \"South_Korea\",\n  \"Iran\",\n  \"Israel\",\n  \"Netherlands\",\n  \"Peru\",\n];\n\nexport const DATA_SOURCES = [\n  {\n    name: \"ECDC\",\n    url: \"https://www.ecdc.europa.eu/en/publications-data/download-todays-data-geographic-distribution-covid-19-cases-worldwide\",\n  },\n  { name: \"Brasil.IO\", url: \"https://brasil.io/dataset/covid19/caso\" },\n  {\n    name: \"PHAS\",\n    url: \"https://www.folkhalsomyndigheten.se/smittskydd-beredskap/utbrott/aktuella-utbrott/covid-19/aktuellt-epidemiologiskt-lage\",\n  },\n  { name: \"NY Times\", url: \"https://github.com/nytimes/covid-19-data\" },\n  { name: \"ISC\", url: \"https://covid19.isciii.es/\" },\n  {\n    name: \"PHE\",\n    url: \"https://www.gov.uk/government/publications/covid-19-track-coronavirus-cases\",\n  },\n];\n\nexport const PLACE_TYPE_LABEL_MAPPING: Record<string, string> = {\n  state: \"States\",\n  city: \"Cities\",\n  autonomous_community: \"Autonomous Communities\",\n  country: \"Countries\",\n  county: \"Counties\",\n  nhsr: \"NHSRs\",\n  utla: \"UTLAs\",\n  health_board: \"Health Boards\",\n  lgd: \"LGDs\",\n  unknown: \"Other regions\",\n  region: \"Regions\",\n  departamento: \"Departments\",\n  provincia: \"Provinces\",\n  province: \"Provinces\",\n  lower_tier_local_authority: \"LTLAs\",\n};\n\nexport const SIMILARITY_API = `${process.env.REACT_APP_SIMILARITY_API}`;\n","import { useMemo } from \"react\";\nimport { useQuery } from \"react-query\";\n\nexport type MetadataRegion = {\n  name: string;\n  file: string;\n  iso: string;\n  place_type: string;\n  parent?: string;\n};\n\nexport type MetadataCountry = {\n  name: string;\n  file: string;\n  geoId: string;\n  countryTerritoryCode: string;\n  parent: string;\n  regions: Record<string, MetadataRegion>;\n};\n\nexport type Metadata = Record<string, MetadataCountry>;\n\nconst fetchMetadata = async () => {\n  const response = await fetch(\"https://raw.githubusercontent.com/inf-covid19/covid19-data/master/data/metadata.json\");\n  const data = await response.json();\n  return data as Metadata;\n};\n\nexport default function useMetadata() {\n  const { data = null, status, error } = useQuery(\"metadata\", fetchMetadata);\n\n  return useMemo(() => ({ data, loading: status === \"loading\", error }), [data, status, error]);\n}\n","import get from \"lodash/get\";\nimport { Metadata, MetadataRegion, MetadataCountry } from \"../hooks/useMetadata\";\nimport { FlagNameValues } from \"semantic-ui-react\";\n\nconst getRegionPath = (id: string) => {\n  const [country, region] = id.split(\".regions.\");\n  if (!!region) {\n    return [country, \"regions\", region];\n  }\n  return [country];\n};\n\nexport function getByRegionId(metadata: Metadata, regionId: string) {\n  const regionPath = getRegionPath(regionId);\n  const [country] = regionPath;\n\n  if (country === regionId) {\n    const { regions, ...data } = metadata[country];\n\n    return {\n      key: regionId,\n      flag: getFlag(data),\n      displayName: getNameFromCountry(data),\n      file: data.file,\n      parent: data.parent,\n      name: data.name,\n      isCountry: true,\n    };\n  }\n\n  const data: MetadataRegion = get(metadata, regionPath);\n  const countryData = metadata[country];\n\n  return {\n    key: regionId,\n    country,\n    flag: getFlag(countryData),\n    displayName: getNameFromRegion(data),\n    file: data.file,\n    parent: data.parent,\n    name: data.name,\n    isCountry: false,\n    place_type: data.place_type,\n  };\n}\n\nexport function getFileByRegionId(metadata: Metadata, regionId: string) {\n  const regionData = getByRegionId(metadata, regionId);\n  return regionData.file;\n}\n\nfunction getNameFromRegion(data: Pick<MetadataRegion, \"name\" | \"parent\">) {\n  if (!!data.parent) {\n    return `${data.name.replace(/_/g, \" \")}, ${data.parent.replace(/_/g, \" \")}`;\n  }\n\n  return data.name.replace(/_/g, \" \");\n}\n\nfunction getNameFromCountry(data: Pick<MetadataCountry, \"name\">) {\n  return data.name.replace(/_/g, \" \");\n}\n\nfunction getFlag(data: Pick<MetadataCountry, \"name\" | \"geoId\">) {\n  if (data.name === \"Greece\") {\n    return 'greece';\n  }\n\n  return data.geoId.toLowerCase() as FlagNameValues;\n}\n","import Fuse from \"fuse.js\";\nimport { castArray, defaultTo, groupBy, isEmpty, keyBy, sortBy, uniq } from \"lodash\";\nimport debounce from \"lodash/debounce\";\nimport first from \"lodash/first\";\nimport React, { Fragment, useCallback, useMemo, useState } from \"react\";\nimport { Dropdown, Flag, Header } from \"semantic-ui-react\";\nimport { DEFAULT_COUNTRIES, PLACE_TYPE_LABEL_MAPPING } from \"../constants\";\nimport useMetadata from \"../hooks/useMetadata\";\nimport { getByRegionId } from \"../utils/metadata\";\nimport \"./RegionSelector.css\";\n\ntype Props = {\n  value: Record<string, boolean>;\n  multiple?: boolean;\n  onChange: (value: Record<string, boolean>) => void;\n  filter?: (key: string) => boolean;\n};\n\nexport default function RegionSelector({ value, onChange, multiple = true, filter = () => true }: Props) {\n  const [search, setSearch] = useState(\"\");\n  const [fromValue, setFromValue] = useState(\"all\");\n  const selected = useMemo(() => Object.keys(value).filter((k) => value[k]), [value]);\n  const { data: metadata, loading } = useMetadata();\n\n  const [regions, groups] = useMemo(() => {\n    if (!metadata) return [{}, {}];\n\n    const groups: Record<string, Record<string, Array<{ value: string; name: string; parent: string; flag: string; text: string; country: string }>>> = {};\n\n    const arr = Object.entries(metadata).flatMap(([country, countryData]) => {\n      const { flag, displayName } = getByRegionId(metadata, country);\n\n      const regions = Object.entries(countryData.regions as Record<string, any>).map(([region, regionData]) => ({\n        value: `${country}.regions.${region}`,\n        name: regionData.name as string,\n        parent: `${regionData.parent || country}`,\n        flag,\n        text: `${regionData.name}${regionData.parent ? `, ${regionData.parent}` : \"\"}, ${displayName}`,\n        type: `${regionData.place_type}`,\n        country,\n      }));\n\n      groups[country] = groupBy(regions, (r) => `${r.parent}:${r.type}`)!;\n\n      return [\n        {\n          value: country,\n          name: displayName,\n          text: displayName,\n          flag,\n        },\n        ...regions,\n      ];\n    });\n\n    return [keyBy(arr, \"value\"), groups];\n  }, [metadata]);\n\n  const fromOptions = useMemo(() => {\n    const defaultFromOptions = [\n      {\n        content: \"Everywhere\",\n        text: \"everywhere\",\n        value: \"all\",\n        icon: \"globe\",\n      },\n    ];\n\n    if (!metadata) return defaultFromOptions;\n\n    const fromOptions = Object.entries(metadata).flatMap(([country, countryData]) => {\n      if (Object.keys(countryData.regions).length === 0) return [];\n      const { displayName, flag } = getByRegionId(metadata, country);\n\n      return [\n        {\n          text: displayName,\n          value: country,\n          flag: flag,\n        },\n      ];\n    });\n\n    return [...defaultFromOptions, ...fromOptions];\n  }, [metadata]);\n\n  const fuse = useMemo(() => {\n    return new Fuse(Object.values(regions), {\n      minMatchCharLength: 1,\n      threshold: 0.3,\n      keys: [\n        { name: \"name\", weight: 0.5 },\n        { name: \"parent\", weight: 0.3 },\n        { name: \"country\", weight: 0.2 },\n      ],\n    });\n  }, [regions]);\n\n  const selectedOptions = useMemo(() => {\n    return selected.map((value) => regions[value]).filter(Boolean);\n  }, [regions, selected]);\n\n  const allOptions = useMemo(() => {\n    if (fromValue !== \"all\") {\n      return selectedOptions.concat(\n        sortBy(\n          Object.values(regions).filter((region) => \"country\" in region && region.country === fromValue),\n          [\"value\"]\n        )\n      );\n    }\n\n    if (search.length < 1) return selectedOptions;\n\n    const result = fuse.search(search, { limit: 30 }).map(({ item }) => item);\n    return selectedOptions.concat(result);\n  }, [fromValue, search, selectedOptions, fuse, regions]);\n\n  const options = useMemo(() => {\n    return allOptions.filter((o) => filter(o.value));\n  }, [allOptions, filter]);\n\n  const onSearchChangeHandler = useCallback(\n    debounce((_: any, { searchQuery }: any) => {\n      setSearch(searchQuery);\n    }, 100),\n    []\n  );\n\n  const setSelected = useCallback(\n    (values: string[]) => {\n      onChange(Object.fromEntries(values.map((k) => [k, true])));\n    },\n    [onChange]\n  );\n\n  const onChangeHandler = useCallback(\n    (_: any, { value }: any) => {\n      setSelected(castArray(value));\n      setSearch(\"\");\n    },\n    [setSelected]\n  );\n\n  return (\n    <div>\n      {multiple && (\n        <div\n          style={{\n            display: \"flex\",\n            marginBottom: \"1rem\",\n          }}\n        >\n          <div style={{ marginRight: \"2rem\" }}>\n            <Header as=\"h4\">\n              Select regions from{\" \"}\n              <Dropdown\n                selectOnNavigation={false}\n                style={{ zIndex: 13 }}\n                header=\"Adjust scope\"\n                inline\n                options={fromOptions}\n                value={fromValue}\n                onChange={(_: any, { value }: any) => setFromValue(value)}\n              />\n            </Header>\n          </div>\n\n          <div>\n            <Header as=\"h4\" color=\"grey\">\n              <Dropdown selectOnNavigation={false} style={{ zIndex: 13 }} text=\"Select region group\" inline direction=\"left\" scrolling>\n                <Dropdown.Menu>\n                  <Fragment key={\"world\"}>\n                    <Dropdown.Header icon=\"globe\" content=\"World\" />\n                    <Dropdown.Item className=\"RegionSelector--group--item\" onClick={() => setSelected(uniq(selected.concat(DEFAULT_COUNTRIES)))}>\n                      Default countries\n                    </Dropdown.Item>\n                  </Fragment>\n                  {metadata &&\n                    Object.entries(groups).flatMap(([country, regions]) => {\n                      if (isEmpty(regions)) {\n                        return null;\n                      }\n\n                      const { displayName, flag } = getByRegionId(metadata, country);\n\n                      return (\n                        <Fragment key={country}>\n                          <Dropdown.Header>\n                            <Flag name={flag} /> {displayName}\n                          </Dropdown.Header>\n                          {Object.entries(regions).map(([group, items]) => {\n                            const [groupName, type] = group.split(\":\", 2);\n\n                            return (\n                              <Dropdown.Item\n                                key={`${country}-${group}`}\n                                className=\"RegionSelector--group--item\"\n                                onClick={() => setSelected(uniq(selected.concat(items.map((i) => i.value))))}\n                              >\n                                {`${PLACE_TYPE_LABEL_MAPPING[type]} from ${groupName.replace(/_/g, \" \")}`}\n                              </Dropdown.Item>\n                            );\n                          })}\n                        </Fragment>\n                      );\n                    })}\n                </Dropdown.Menu>\n              </Dropdown>\n            </Header>\n          </div>\n        </div>\n      )}\n      <Dropdown\n      className={multiple ? undefined : 'large'}\n        selectOnNavigation={false}\n        style={{ zIndex: 12 }}\n        placeholder={fromValue === \"all\" ? \"Search for countries, states, provinces...\" : `Choose regions from ${fromValue}...`}\n        clearable\n        fluid\n        search\n        multiple={multiple}\n        selection\n        loading={loading}\n        options={options}\n        value={multiple ? selected : defaultTo(first(selected), undefined)}\n        minCharacters={1}\n        noResultsMessage={search.length < 1 ? \"Start typing...\" : \"No results found.\"}\n        onChange={onChangeHandler}\n        onSearchChange={onSearchChangeHandler}\n      />\n    </div>\n  );\n}\n","import * as d3 from \"d3\";\nimport download from \"downloadjs\";\nimport { get, keyBy, uniq } from \"lodash\";\nimport React, { useMemo } from \"react\";\nimport { Dropdown } from \"semantic-ui-react\";\nimport slugify from \"slugify\";\n\ntype Props = {\n  title: string;\n  metric: string;\n  isCumulative: boolean;\n  chart: React.RefObject<any>;\n};\n\nexport default function ExportChart({ chart, title, isCumulative, metric }: Props) {\n  const [loading, setLoading] = React.useState(false);\n\n  const fileName = useMemo(() => {\n    return slugify(`${title}_${isCumulative ? \"total\" : \"daily\"}-${metric}`);\n  }, [isCumulative, metric, title]);\n\n  return (\n    <Dropdown className=\"button\" text=\"Export\" loading={loading}>\n      <Dropdown.Menu>\n        <Dropdown.Item\n          text=\"Export as SVG\"\n          onClick={() => {\n            setLoading(true);\n\n            const paper = chart.current?.chart.paper();\n            const svg = paper.svg();\n            download(svg, `${fileName}.svg`, \"image/svg+xml\");\n\n            setLoading(false);\n          }}\n        />\n        <Dropdown.Item\n          text=\"Export as PNG\"\n          onClick={() => {\n            setLoading(true);\n\n            chart.current?.chart.dataURI().then(({ imgURI }: any) => {\n              download(imgURI, `${fileName}.png`, \"image/png\");\n              setLoading(false);\n            });\n          }}\n        />\n        <Dropdown.Item\n          text=\"Export as CSV\"\n          onClick={() => {\n            setLoading(true);\n\n            const series: { key: string; name: string; data: { x: number; y: number }[] }[] = chart.current?.props?.series;\n\n            const X = uniq(series.flatMap((s) => s.data.map((item) => item.x)));\n            const seriesKeyed = series.map((item) => {\n              return {\n                ...item,\n                data: keyBy(item.data, \"x\"),\n              };\n            });\n            const seriesNames = series.map((item) => item.name);\n\n            const data = [[\"\", ...seriesNames]];\n\n            X?.forEach((x) => {\n              data.push([`${x}`, ...seriesKeyed.map((item) => `${get(item.data, [x, \"y\"], \"\")}`)]);\n            });\n\n            const csv = d3.csvFormatRows(data);\n            download(csv, `${fileName}.csv`, \"text/csv\");\n\n            setLoading(false);\n          }}\n        />\n      </Dropdown.Menu>\n    </Dropdown>\n  );\n}\n","import React, { Fragment, useEffect, useMemo, useRef, useState, useCallback } from \"react\";\nimport { Button, Card, Checkbox, Container, Form, Grid, Header, Icon, Image, Segment } from \"semantic-ui-react\";\nimport { DEFAULT_COUNTRIES, DEFAULT_OPTIONS, ChartType, MetricType, ScaleType, ProjectionType } from \"../constants\";\nimport \"./Editor.css\";\nimport RegionSelector from \"./RegionSelector\";\nimport { omit } from \"lodash\";\nimport ExportChart from \"./ExportChart\";\n\ntype SelectedCountriesMap = Record<string, boolean>;\nexport type ChartOptions = {\n  chartType: ChartType;\n  metric: MetricType;\n  isCumulative: boolean;\n  alignAt: number;\n  showDataLabels: boolean;\n  title: string;\n  dayInterval: number;\n  selectedRegions: SelectedCountriesMap;\n  scale: ScaleType;\n  predictionDays: number;\n  projectionType: ProjectionType;\n  epsilon: number;\n  perplexity: number;\n  iterations: number;\n  timeserieSlice: number;\n  spread: number;\n  neighbors: number;\n  minDist: number;\n};\n\nconst SAVED_CHARTS_KEY = \"covid19-tools.editor.savedCharts.v2\";\nconst DEFAULTS_KEY = \"covid19-tools.editor.defaults.v2\";\n\nfunction getSavedCharts(\n  id?: string\n): Array<\n  {\n    dataURI: string;\n  } & ChartOptions\n> {\n  if (localStorage.hasOwnProperty(`${SAVED_CHARTS_KEY}${id ? `.${id}` : \"\"}`)) {\n    const savedChartsJSON = localStorage.getItem(`${SAVED_CHARTS_KEY}${id ? `.${id}` : \"\"}`);\n    if (savedChartsJSON) {\n      return JSON.parse(savedChartsJSON).map((savedChart: any) => {\n        if (savedChart.hasOwnProperty(\"selectedCountries\")) {\n          savedChart.selectedRegions = savedChart.selectedCountries;\n          delete savedChart.selectedCountries;\n        }\n        return savedChart;\n      });\n    }\n  }\n  return [];\n}\n\nconst getDefaultsValues = (id?: string): ChartOptions => {\n  const defaults = {\n    ...DEFAULT_OPTIONS,\n    selectedRegions: Object.fromEntries(DEFAULT_COUNTRIES.map((k) => [k, true])),\n  };\n\n  if (localStorage.hasOwnProperty(`${DEFAULTS_KEY}${id ? `.${id}` : \"\"}`)) {\n    const savedChartsJSON = localStorage.getItem(`${DEFAULTS_KEY}${id ? `.${id}` : \"\"}`);\n    if (savedChartsJSON) {\n      const parsedDefaults = JSON.parse(savedChartsJSON);\n      if (parsedDefaults.hasOwnProperty(\"selectedCountries\")) {\n        parsedDefaults.selectedRegions = parsedDefaults.selectedCountries;\n        delete parsedDefaults.selectedCountries;\n      }\n\n      Object.entries(parsedDefaults.selectedRegions).forEach(([key, enabled]) => {\n        if (!enabled) {\n          delete parsedDefaults.selectedRegions[key];\n        }\n      });\n\n      return {\n        ...defaults,\n        ...parsedDefaults,\n      };\n    }\n  }\n\n  return defaults as ChartOptions;\n};\n\ntype EditorProps = {\n  id?: string;\n  isPredictionChart?: boolean;\n  availableOptions: Array<keyof ChartOptions>;\n  render: (ref: React.MutableRefObject<any>, options: ChartOptions) => React.ReactNode;\n};\n\nfunction Editor(props: EditorProps) {\n  const { id, availableOptions, isPredictionChart } = props;\n\n  const defaultsValues = useMemo(() => getDefaultsValues(props.id), [props.id]);\n\n  const [savedCharts, setSavedCharts] = useState(getSavedCharts(props.id));\n\n  const chartRef = useRef<any>(null);\n\n  const [options, setOptions] = useState(defaultsValues);\n\n  const {\n    chartType,\n    metric,\n    scale,\n    alignAt,\n    isCumulative,\n    showDataLabels,\n    title,\n    dayInterval,\n    selectedRegions,\n    predictionDays,\n    projectionType,\n    epsilon,\n    perplexity,\n    iterations,\n    timeserieSlice,\n    spread,\n    neighbors,\n    minDist,\n  } = options;\n\n  const [saved, setSaved] = useState(false);\n  const [saving, setSaving] = useState(false);\n\n  useEffect(() => {\n    localStorage.setItem(`${SAVED_CHARTS_KEY}${id ? `.${id}` : \"\"}`, JSON.stringify(savedCharts));\n  }, [id, savedCharts]);\n\n  useEffect(() => {\n    localStorage.setItem(`${DEFAULTS_KEY}${id ? `.${id}` : \"\"}`, JSON.stringify(options));\n  }, [id, options]);\n\n  useEffect(() => {\n    let cancelled = false;\n    if (saved) {\n      setTimeout(() => {\n        if (cancelled) return;\n        setSaved(false);\n      }, 3000);\n    }\n    return () => {\n      cancelled = true;\n    };\n  }, [saved]);\n\n  const setSelectedRegions = useCallback((regions) => setOptions((opt) => ({ ...opt, selectedRegions: regions })), []);\n\n  return (\n    <div>\n      {availableOptions.includes(\"selectedRegions\") && (\n        <Container>\n          <RegionSelector value={selectedRegions} onChange={setSelectedRegions} />\n        </Container>\n      )}\n      <Grid padded>\n        <Grid.Row>\n          <Grid.Column width={12}>\n            <Segment>\n              {props.render(chartRef, {\n                chartType,\n                isCumulative,\n                title,\n                metric,\n                showDataLabels,\n                dayInterval,\n                selectedRegions,\n                alignAt,\n                scale,\n                predictionDays,\n                epsilon,\n                perplexity,\n                iterations,\n                timeserieSlice,\n                projectionType,\n                spread,\n                neighbors,\n                minDist,\n              })}\n            </Segment>\n          </Grid.Column>\n          <Grid.Column width={4}>\n            <Segment style={{ height: \"100%\" }}>\n              <Form>\n                <Header>Options</Header>\n\n                {availableOptions.includes(\"title\") && (\n                  <Form.Field>\n                    <label>Title</label>\n                    <input placeholder=\"Enter a title\" type=\"text\" defaultValue={title} onBlur={({ target }: any) => setOptions({ ...options, title: target.value })} />\n                  </Form.Field>\n                )}\n\n                {availableOptions.includes(\"chartType\") && (\n                  <Form.Select\n                    label=\"Choose chart type\"\n                    value={chartType}\n                    onChange={(_, { value }) => setOptions({ ...options, chartType: value as ChartType })}\n                    options={[\n                      { key: \"heatmap\", text: \"Heatmap\", value: \"heatmap\" },\n                      { key: \"line\", text: \"Line\", value: \"line\" },\n                      { key: \"area\", text: \"Area\", value: \"area\" },\n                      { key: \"bar\", text: \"Bar\", value: \"bar\" },\n                      { key: \"scatter\", text: \"Scatter\", value: \"scatter\" },\n                    ]}\n                  />\n                )}\n                {availableOptions.includes(\"predictionDays\") && (\n                  <Form.Field>\n                    <label>How many days would you like to predict?</label>\n                    <input\n                      type=\"number\"\n                      placeholder=\"Enter a number\"\n                      min=\"0\"\n                      defaultValue={predictionDays}\n                      onBlur={({ target }: any) => setOptions({ ...options, predictionDays: parseInt(target.value) || 0 })}\n                    />\n                  </Form.Field>\n                )}\n\n                {availableOptions.includes(\"isCumulative\") && (\n                  <Form.Select\n                    label=\"Choose total or daily\"\n                    value={isCumulative ? \"total\" : \"daily\"}\n                    onChange={(_, { value }) => setOptions({ ...options, isCumulative: value === \"total\" })}\n                    options={[\n                      { key: \"total\", text: \"Total\", value: \"total\" },\n                      { key: \"daily\", text: \"Daily\", value: \"daily\" },\n                    ]}\n                  />\n                )}\n                {availableOptions.includes(\"metric\") && (\n                  <Form.Select\n                    label=\"Choose cases or deaths\"\n                    value={metric}\n                    onChange={(_, { value }) => setOptions({ ...options, metric: value as MetricType })}\n                    options={[\n                      { key: \"cases\", text: \"Cases\", value: \"cases\" },\n                      { key: \"deaths\", text: \"Deaths\", value: \"deaths\" },\n                    ]}\n                  />\n                )}\n\n                {availableOptions.includes(\"scale\") && (\n                  <Form.Select\n                    label=\"Choose linear or logarithmic scale\"\n                    value={scale}\n                    onChange={(_, { value }) => setOptions({ ...options, scale: value as ScaleType })}\n                    options={[\n                      { key: \"linear\", text: \"Linear\", value: \"linear\" },\n                      { key: \"log\", text: \"Logarithmic\", value: \"log\" },\n                    ]}\n                  />\n                )}\n\n                {availableOptions.includes(\"alignAt\") && (\n                  <Form.Field>\n                    <label>Minimum number of {metric} to align timeline</label>\n                    <input\n                      type=\"number\"\n                      placeholder=\"Enter a number\"\n                      min=\"0\"\n                      defaultValue={alignAt}\n                      onBlur={({ target }: any) => setOptions({ ...options, alignAt: parseInt(target.value) || 0 })}\n                    />\n                  </Form.Field>\n                )}\n\n                {availableOptions.includes(\"dayInterval\") && (\n                  <Form.Field disabled={alignAt > 0}>\n                    <label>{isPredictionChart ? \"Number of past days used in the prediction\" : \"How many past days would you like to see?\"}</label>\n                    <input\n                      type=\"number\"\n                      placeholder=\"Enter a number\"\n                      min=\"0\"\n                      defaultValue={dayInterval}\n                      onBlur={({ target }: any) => setOptions({ ...options, dayInterval: parseInt(target.value) || dayInterval })}\n                    />\n                  </Form.Field>\n                )}\n                {availableOptions.includes(\"timeserieSlice\") && (\n                  <Form.Field>\n                    <label>Region vector size</label>\n                    <input\n                      type=\"number\"\n                      placeholder=\"Enter a number\"\n                      defaultValue={timeserieSlice}\n                      onBlur={({ target }: any) => setOptions({ ...options, timeserieSlice: parseInt(target.value) || 0 })}\n                    />\n                  </Form.Field>\n                )}\n\n                {availableOptions.includes(\"projectionType\") && (\n                  <Form.Select\n                    label=\"Choose projection technique\"\n                    value={projectionType}\n                    onChange={(_, { value }) => setOptions({ ...options, projectionType: value as ProjectionType })}\n                    options={[\n                      { key: \"umap\", text: \"UMAP\", value: \"umap\" },\n                      { key: \"tsne\", text: \"t-SNE\", value: \"tsne\" },\n                    ]}\n                  />\n                )}\n\n                {projectionType === \"tsne\" && (\n                  <React.Fragment>\n                    {availableOptions.includes(\"epsilon\") && (\n                      <Form.Field>\n                        <label>t-SNE: epsilon</label>\n                        <input\n                          type=\"number\"\n                          placeholder=\"Enter a number\"\n                          defaultValue={epsilon}\n                          onBlur={({ target }: any) => setOptions({ ...options, epsilon: parseInt(target.value) || 0 })}\n                        />\n                      </Form.Field>\n                    )}\n\n                    {availableOptions.includes(\"perplexity\") && (\n                      <Form.Field>\n                        <label>t-SNE: perplexity</label>\n                        <input\n                          type=\"number\"\n                          placeholder=\"Enter a number\"\n                          defaultValue={perplexity}\n                          onBlur={({ target }: any) => setOptions({ ...options, perplexity: parseInt(target.value) || 0 })}\n                        />\n                      </Form.Field>\n                    )}\n                    {availableOptions.includes(\"iterations\") && (\n                      <Form.Field>\n                        <label>Number of iterations</label>\n                        <input\n                          type=\"number\"\n                          placeholder=\"Enter a number\"\n                          defaultValue={iterations}\n                          onBlur={({ target }: any) => setOptions({ ...options, iterations: parseInt(target.value) || 0 })}\n                        />\n                      </Form.Field>\n                    )}\n                  </React.Fragment>\n                )}\n                {projectionType === \"umap\" && (\n                  <React.Fragment>\n                    {availableOptions.includes(\"spread\") && (\n                      <Form.Field>\n                        <label>UMAP: spread</label>\n                        <input\n                          type=\"number\"\n                          placeholder=\"Enter a number\"\n                          defaultValue={spread}\n                          onBlur={({ target }: any) => setOptions({ ...options, spread: parseInt(target.value) || 0 })}\n                        />\n                      </Form.Field>\n                    )}\n\n                    {availableOptions.includes(\"neighbors\") && (\n                      <Form.Field>\n                        <label>UMAP: neighbors</label>\n                        <input\n                          type=\"number\"\n                          placeholder=\"Enter a number\"\n                          defaultValue={neighbors}\n                          onBlur={({ target }: any) => setOptions({ ...options, neighbors: parseInt(target.value) || 0 })}\n                        />\n                      </Form.Field>\n                    )}\n\n                    {availableOptions.includes(\"minDist\") && (\n                      <Form.Field>\n                        <label>UMAP: minDist</label>\n                        <input\n                          type=\"number\"\n                          placeholder=\"Enter a number\"\n                          defaultValue={minDist}\n                          onBlur={({ target }: any) => setOptions({ ...options, minDist: parseFloat(target.value) || 0 })}\n                        />\n                      </Form.Field>\n                    )}\n                  </React.Fragment>\n                )}\n\n                {availableOptions.includes(\"showDataLabels\") && (\n                  <Form.Field>\n                    <Checkbox toggle checked={showDataLabels} onChange={() => setOptions({ ...options, showDataLabels: !showDataLabels })} label=\"Show data labels\" />\n                  </Form.Field>\n                )}\n\n                <div className=\"Editor--actions--container\">\n                  <Button\n                    type=\"button\"\n                    primary\n                    loading={saving}\n                    positive={saved}\n                    onClick={() => {\n                      setSaving(true);\n                      chartRef.current?.chart.dataURI().then(({ imgURI }: any) => {\n                        const newSavedCharts = [\n                          ...savedCharts,\n                          {\n                            dataURI: imgURI,\n                            ...options,\n                          },\n                        ];\n                        setSavedCharts(newSavedCharts);\n                        setSaved(true);\n                        setSaving(false);\n                      });\n                    }}\n                  >\n                    {saved ? \"Saved\" : \"Save\"}\n                  </Button>\n\n                  <Button type=\"button\" onClick={() => setOptions((opt) => ({ ...opt, ...omit(DEFAULT_OPTIONS, [\"selectedRegions\"]) } as ChartOptions))}>\n                    Reset\n                  </Button>\n\n                  <ExportChart title={options.title} metric={options.metric} isCumulative={options.isCumulative} chart={chartRef} />\n                </div>\n              </Form>\n            </Segment>\n          </Grid.Column>\n        </Grid.Row>\n        <Grid.Row>\n          <Grid.Column width={16}>\n            <Segment placeholder={savedCharts.length === 0}>\n              {savedCharts.length > 0 ? (\n                <Fragment>\n                  <Header as=\"h3\">Saved Charts</Header>\n                  <div className=\"Editor--saved-charts--container\">\n                    {savedCharts.map((item, index) => {\n                      return (\n                        <Card key={`${index}-${item.title}`} className=\"Editor--saved-charts--container--card\">\n                          <Image className=\"Editor--saved-charts--container--card--image\" alt={item.title} wrapped ui={false} src={item.dataURI} />\n                          <Card.Content>\n                            <Card.Header>{item.title}</Card.Header>\n                            <Card.Meta>{`${item.isCumulative ? \"Total\" : \"Daily\"} number of ${item.metric}`}</Card.Meta>\n                          </Card.Content>\n                          <Card.Content extra>\n                            <span className=\"right floated\">Past {item.dayInterval} days</span>\n\n                            <Icon name=\"map marker\" />\n                            {`${Object.keys(item.selectedRegions).filter((k) => item.selectedRegions[k]).length} regions`}\n                          </Card.Content>\n\n                          <Button.Group widths=\"2\" attached=\"bottom\">\n                            <Button\n                              primary\n                              onClick={() => {\n                                setOptions(item);\n                                window.scrollTo(0, 0);\n                              }}\n                            >\n                              Load\n                            </Button>\n\n                            <Button\n                              onClick={() => {\n                                setSavedCharts(savedCharts.filter((_, idx) => index !== idx));\n                              }}\n                            >\n                              Remove\n                            </Button>\n                          </Button.Group>\n                        </Card>\n                      );\n                    })}\n                  </div>\n                </Fragment>\n              ) : (\n                <Header icon>\n                  <Icon name=\"save outline\" />\n                  No charts were saved yet.\n                </Header>\n              )}\n            </Segment>\n          </Grid.Column>\n        </Grid.Row>\n      </Grid>\n    </div>\n  );\n}\nexport default Editor;\n","import { DSVRowArray, DSVRowString } from \"d3\";\nimport { differenceInDays, eachDayOfInterval, isAfter, isBefore, parse, startOfDay, subDays } from \"date-fns\";\nimport get from \"lodash/get\";\nimport orderBy from \"lodash/orderBy\";\nimport { getByRegionId } from \"./metadata\";\n\nconst PLACE_TYPE_COLUMN_MAPPING: Record<string, string> = {\n  state: \"state\",\n  city: \"city\",\n  county: \"county\",\n};\n\nconst REGION_CUSTOM_CONFIG = {\n  Brazil: {\n    columns: {\n      cases: \"confirmed\",\n    },\n  },\n};\n\nconst parseDate = (row: DSVRowString, country: string, isCountry: boolean) => {\n  const dateColumn = get(REGION_CUSTOM_CONFIG, [country, \"columns\", \"date\"], isCountry ? \"dateRep\" : \"date\");\n  const dateFormat = get(REGION_CUSTOM_CONFIG, [country, \"date\", \"format\"], isCountry ? \"dd/MM/yyyy\" : \"yyyy-MM-dd\");\n\n  return parse(row[dateColumn]!, dateFormat, startOfDay(new Date()));\n};\n\nexport type TimeseriesRow = {\n  date: Date;\n  cases: number;\n  cases_daily: number;\n  deaths: number;\n  deaths_daily: number;\n};\n\nexport function alignTimeseries(timeseries: TimeseriesRow[], earliestDate: Date) {\n  if (timeseries.length === 0) {\n    return [];\n  }\n\n  if (!isBefore(earliestDate, timeseries[0].date)) {\n    return timeseries.filter((d) => isAfter(d.date, subDays(earliestDate, 1)));\n  }\n\n  const missingDays = eachDayOfInterval({\n    start: earliestDate,\n    end: timeseries[0].date,\n  });\n\n  return [\n    ...missingDays.slice(0, -1).map((date) => ({\n      date,\n      cases: 0,\n      cases_daily: 0,\n      deaths: 0,\n      deaths_daily: 0,\n    })),\n    ...timeseries,\n  ];\n}\n\nexport default function normalizeTimeseries(regionId: string, timeseriesRaw: DSVRowArray, regionData: ReturnType<typeof getByRegionId>) {\n  const { country = \"countries\", isCountry } = regionData;\n\n  let timeseries: DSVRowString[] = timeseriesRaw;\n\n  // filtering based on region, because it can have multiple regions in the same csv\n  if (!isCountry) {\n    timeseries = timeseries.filter((row) => regionData.place_type === row.place_type && row[get(PLACE_TYPE_COLUMN_MAPPING, row.place_type!, \"region\")] === regionData.name);\n  }\n\n  // ensure order (more recent sits at the end of the timeseries)\n  timeseries = orderBy(timeseries, (row) => parseDate(row, country, isCountry));\n\n  const casesColumn = isCountry ? \"cases\" : get(REGION_CUSTOM_CONFIG, [country, \"columns\", \"cases\"], \"cases\");\n  const deathsColumn = isCountry ? \"deaths\" : get(REGION_CUSTOM_CONFIG, [country, \"columns\", \"deaths\"], \"deaths\");\n\n  let prevDate: Date;\n  let totalCases = 0;\n  let totalDeaths = 0;\n\n  // normalize timeseries (include cases, cases_daily, deaths, deaths_daily)\n  const data: TimeseriesRow[] = [];\n  timeseries.forEach((row) => {\n    const date = parseDate(row, country, isCountry);\n\n    if (prevDate && differenceInDays(date, prevDate) > 1) {\n      const missingInterval = eachDayOfInterval({\n        start: prevDate,\n        end: date,\n      });\n      missingInterval.slice(1, missingInterval.length - 1).forEach((missingDate) => {\n        data.push({\n          date: missingDate,\n          cases: totalCases,\n          cases_daily: 0,\n          deaths: totalDeaths,\n          deaths_daily: 0,\n        });\n      });\n    }\n\n    const cases = isCountry ? totalCases + Number(get(row, casesColumn, 0)) : Number(get(row, casesColumn, totalCases));\n    const cases_daily = Math.max(0, cases - totalCases);\n\n    const deaths = isCountry ? totalDeaths + Number(get(row, deathsColumn, 0)) : Number(get(row, deathsColumn, totalDeaths));\n    const deaths_daily = Math.max(0, deaths - totalDeaths);\n\n    if (cases < totalCases || deaths < totalDeaths) {\n      data.forEach((entry, index) => {\n        if (entry.cases > cases) {\n          data[index].cases = cases;\n          data[index].cases_daily = Math.max(0, cases - get(data, [index - 1, \"cases\"], 0));\n        }\n\n        if (entry.deaths > deaths) {\n          data[index].deaths = deaths;\n          data[index].deaths_daily = Math.max(0, deaths - get(data, [index - 1, \"deaths\"], 0));\n        }\n      });\n    }\n\n    data.push({ date, cases, cases_daily, deaths, deaths_daily });\n\n    totalCases = cases;\n    totalDeaths = deaths;\n    prevDate = date;\n  });\n\n  return data;\n}\n","import { csv } from \"d3\";\nimport { groupBy } from \"lodash\";\nimport sortBy from \"lodash/sortBy\";\nimport { useCallback, useMemo, useRef } from \"react\";\nimport { useQuery } from \"react-query\";\nimport { getByRegionId, getFileByRegionId } from \"../utils/metadata\";\nimport normalizeTimeseries, { TimeseriesRow } from \"../utils/normalizeTimeseries\";\nimport useMetadata from \"./useMetadata\";\n\nexport default function useRegionData(regionIds: string[]) {\n  const cache = useRef<Record<string, TimeseriesRow[]>>({});\n  const { data: metadata } = useMetadata();\n\n  const sortedRegionIds = useMemo(() => sortBy(regionIds), [regionIds]);\n\n  const queryFn = useCallback(\n    async (_: string, keys: string[]) => {\n      if (!metadata) return {};\n\n      const cachedKeys: string[] = [];\n      const uncachedKeys: string[] = [];\n      keys.forEach((key) => {\n        (!!cache.current[key] ? cachedKeys : uncachedKeys).push(key);\n      });\n\n      const keysByFile = groupBy(uncachedKeys, (k: string) => getFileByRegionId(metadata, k));\n      const files = Object.keys(keysByFile);\n\n      const dataByKey: Record<string, TimeseriesRow[]> = {};\n\n      const data = await Promise.all(files.map((file) => csv(`https://raw.githubusercontent.com/inf-covid19/covid19-data/master/${file}?v=2`)));\n      data.forEach((raw, index) => {\n        keysByFile[files[index]].forEach((key) => {\n          dataByKey[key] = normalizeTimeseries(key, raw, getByRegionId(metadata, key));\n        });\n      });\n\n      cachedKeys.forEach((key) => {\n        dataByKey[key] = cache.current[key];\n      });\n\n      cache.current = dataByKey;\n\n      return dataByKey;\n    },\n    [metadata]\n  );\n\n  const { data, status, error } = useQuery(metadata && [\"region-data\", sortedRegionIds], queryFn);\n\n  return useMemo(() => ({ data, loading: status === \"loading\", error }), [data, status, error]);\n}\n","import { schemeCategory10 } from \"d3\";\nimport { sum } from \"lodash\";\nimport sortBy from \"lodash/sortBy\";\nimport toMaterialStyle from \"material-color-hash\";\nimport { useMemo } from \"react\";\n\nfunction colorHash(input: string) {\n  let seed = sum(Array.from(input).map((_, i) => input.charCodeAt(i) * i));\n\n  const shade = ((Math.sin(seed) + 1) * 6) / 3 + (3 - 0); // (V * R2 / R1) + (M2 - M1)\n  const { backgroundColor } = toMaterialStyle(input, (Math.round(shade) * 100) as any);\n\n  return backgroundColor;\n}\n\nfunction useSeriesColors(series: { key: string; name: string }[]) {\n  return useMemo(() => {\n    const sortedSeries = sortBy(series, \"name\");\n\n    if (sortedSeries.length <= 10) {\n      return sortedSeries.map((_, index) => schemeCategory10[index]);\n    }\n\n    return sortedSeries.map(({ key, name }) => colorHash(key.split(\"\").reverse().join(\"\")));\n  }, [series]);\n}\n\nexport default useSeriesColors;\n","import * as d3 from \"d3\";\nimport { parseToRgb, readableColor, rgbToColorString } from \"polished\";\nimport { useMemo } from \"react\";\n\nfunction useColorScale(series: { data: { y: number }[] }[]) {\n  const colorScale = useMemo(() => {\n    const n = 8;\n\n    const values = series.flatMap((s) => s.data.map(({ y }) => y));\n    const maxDomain = Math.max(...values);\n    const minDomain = Math.max(1, Math.min(...values));\n\n    const colorscale = (d3 as any).scaleSequentialLog(d3.interpolateGnBu).domain([minDomain, maxDomain]);\n    const numscale = d3.scaleLog().domain(colorscale.domain());\n\n    const ticks = numscale.ticks();\n    const step = Math.round(ticks.length / Math.min(n, ticks.length));\n    const t = ticks.filter((_, idx) => idx % step === 0);\n\n    const ranges = [0, ...t].flatMap((value, index, arr) => {\n      const from = index === 0 ? 0 : value + 1;\n      const to = arr[index + 1];\n      const name = from === 0 ? `<${to + 1}` : to === undefined ? `>${from - 1}` : `${from} - ${to}`;\n      const color = rgbToColorString(parseToRgb(colorscale(value)));\n      const foreColor = readableColor(color, \"#4d4d4d\", \"#ffffff\");\n\n      return {\n        from,\n        to: to || maxDomain,\n        color,\n        name,\n        foreColor,\n      };\n    });\n\n    return {\n      ranges,\n    };\n  }, [series]);\n\n  return colorScale;\n}\n\nexport default useColorScale;\n","import * as d3 from \"d3\";\nimport { startOfDay, subDays } from \"date-fns\";\nimport get from \"lodash/get\";\nimport sortBy from \"lodash/sortBy\";\nimport numeral from \"numeral\";\nimport React, { useMemo } from \"react\";\nimport ReactApexChart, { Props } from \"react-apexcharts\";\nimport { Loader } from \"semantic-ui-react\";\nimport useMetadata from \"../hooks/useMetadata\";\nimport useRegionData from \"../hooks/useRegionData\";\nimport useSeriesColors from \"../hooks/useSeriesColors\";\nimport { getByRegionId } from \"../utils/metadata\";\nimport { alignTimeseries, TimeseriesRow } from \"../utils/normalizeTimeseries\";\nimport { ChartOptions } from \"./Editor\";\nimport useColorScale from \"../hooks/useColorScale\";\nimport { isNumber } from \"lodash\";\n\nconst displayNumberFormatter = d3.format(\",.2~f\");\nconst ordinalFormattter = (n: number) => numeral(n).format(\"Oo\");\nconst numberFormatter = d3.format(\".2~s\");\n\ntype CustomizableChartProps = Omit<Props, \"options\" | \"series\" | \"type\"> &\n  ChartOptions & {\n    isIncidence?: boolean;\n    getPopulation?: (key: string) => number;\n  };\n\nfunction CustomizableChart(props: CustomizableChartProps, ref: React.Ref<any>) {\n  const {\n    chartType = \"heatmap\",\n    title,\n    metric,\n    showDataLabels,\n    isCumulative,\n    dayInterval,\n    selectedRegions,\n    alignAt = 0,\n    timeserieSlice,\n    isIncidence,\n    getPopulation,\n    ...rest\n  } = props;\n\n  const regionsIds = useMemo(() => Object.keys(selectedRegions), [selectedRegions]);\n\n  const { data, loading, error } = useRegionData(regionsIds);\n  const { data: metadata } = useMetadata();\n\n  const series = useMemo(() => {\n    if (loading || !data || !metadata) {\n      return [];\n    }\n\n    const earliestDate = subDays(startOfDay(new Date()), dayInterval);\n    return Object.entries(data).flatMap(([region, regionData]) => {\n      const { displayName } = getByRegionId(metadata, region);\n\n      const getValue = (row: TimeseriesRow) => {\n        const value = isCumulative ? (metric === \"cases\" ? row.cases : row.deaths) : metric === \"cases\" ? row.cases_daily : row.deaths_daily;\n\n        if (isIncidence && getPopulation) {\n          const population = getPopulation(region);\n\n          return (value / population) * 100000;\n        }\n\n        return value;\n      };\n\n      if (alignAt > 0) {\n        const alignedData = regionData.filter((v) => v[metric] >= alignAt);\n\n        if (alignedData.length === 0) {\n          return [];\n        }\n\n        return [\n          {\n            name: displayName,\n            key: region,\n            data: alignedData.map((row, index) => ({\n              x: index + 1,\n              y: getValue(row),\n            })),\n          },\n        ];\n      }\n\n      return [\n        {\n          name: displayName,\n          key: region,\n          data: alignTimeseries(regionData, earliestDate).map((row) => ({\n            x: row.date.getTime(),\n            y: getValue(row),\n          })),\n        },\n      ];\n    });\n  }, [loading, data, metadata, dayInterval, alignAt, isCumulative, metric, isIncidence, getPopulation]);\n\n  const sortedSeries = useMemo(() => {\n    return sortBy(\n      series.map((s) => ({\n        ...s,\n        data: s.data.slice(0, timeserieSlice),\n      })),\n      chartType === \"heatmap\" ? (s) => get(s.data, [s.data.length - 1, \"y\"], 0) : \"name\"\n    );\n  }, [series, chartType, timeserieSlice]);\n\n  const seriesColors = useSeriesColors(sortedSeries);\n  const colorScale = useColorScale(sortedSeries);\n\n  const chartOptions = useMemo(() => {\n    return {\n      chart: {\n        fontFamily: \"Lato, 'Helvetica Neue', Arial, Helvetica, sans-serif\",\n        animations: {\n          animateGradually: { enabled: false },\n        },\n        toolbar: {\n          tools: {\n            download: false,\n            selection: false,\n            zoom: false,\n            zoomin: false,\n            zoomout: false,\n            pan: false,\n            reset: false,\n          },\n        },\n      },\n      colors: seriesColors,\n      tooltip: {\n        y: {\n          formatter: (value: number) => `${displayNumberFormatter(value)} ${metric}${isIncidence ? \" per 100k inhab.\" : \"\"}`,\n        },\n        x: {\n          formatter: alignAt > 0 ? (value: number) => `${ordinalFormattter(value)} day after ${numberFormatter(alignAt)} ${metric}` : undefined,\n        },\n      },\n      xaxis: {\n        type: alignAt === 0 ? \"datetime\" : \"numeric\",\n        labels: {\n          formatter: alignAt > 0 ? ordinalFormattter : undefined,\n        },\n      },\n      yaxis: {\n        axisTicks: {\n          offsetX: 5,\n        },\n        axisBorder: {\n          offsetX: 5,\n        },\n        labels: {\n          offsetX: 5,\n          formatter: (value: number | string) => (isNumber(value) ? (value < 1 ? displayNumberFormatter(value) : numberFormatter(value)) : value),\n        },\n        title: {\n          offsetX: 5,\n          text:\n            chartType === \"heatmap\"\n              ? undefined\n              : `${isCumulative ? \"Total\" : \"Daily\"} Confirmed ${metric === \"cases\" ? \"Cases\" : \"Deaths\"}${isIncidence ? \" (per 100k inhab.)\" : \"\"}`,\n        },\n      },\n      dataLabels: {\n        enabled: showDataLabels,\n        formatter: numberFormatter,\n      },\n      title: {\n        text: title,\n        style: {\n          fontSize: \"18px\",\n        },\n      },\n      plotOptions: {\n        heatmap: {\n          colorScale,\n        },\n      },\n    };\n  }, [seriesColors, alignAt, chartType, isCumulative, metric, isIncidence, showDataLabels, title, colorScale]);\n\n  if (loading) {\n    return (\n      <div style={{ height: props.height, display: \"flex\", justifyContent: \"center\", alignItems: \"center\" }}>\n        <Loader active inline />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div style={{ height: props.height, display: \"flex\", justifyContent: \"center\", alignItems: \"center\", textAlign: \"center\" }}>\n        Ooops! Something is wrong.\n        <br />\n        Please try it later or choose different regions.\n      </div>\n    );\n  }\n\n  return (\n    <ReactApexChart\n      key={chartType}\n      ref={ref}\n      options={chartOptions}\n      series={sortedSeries}\n      type={chartType}\n      height={Math.max(Number(rest.height), (chartType === \"heatmap\" ? 30 : 0) * sortedSeries.length)}\n      width={rest.width}\n    />\n  );\n}\n\nexport default React.forwardRef(CustomizableChart);\n","import React from \"react\";\nimport Editor, { ChartOptions } from \"./Editor\";\nimport CustomizableChart from \"./CustomizableChart\";\nimport pick from 'lodash/pick';\n\nconst AVAILABLE_OPTIONS: Array<keyof ChartOptions> = [\"chartType\", \"metric\", \"isCumulative\", \"alignAt\", \"showDataLabels\", \"title\", \"dayInterval\", \"selectedRegions\"]\n\nexport default function ChartEditor() {\n  return (\n    <Editor\n      availableOptions={AVAILABLE_OPTIONS}\n      render={(ref, options) => {\n        return <CustomizableChart ref={ref} {...pick(options, AVAILABLE_OPTIONS)} height={600} />;\n      }}\n    />\n  );\n}\n","import React, { Fragment } from \"react\";\n\nexport default function ListDescriptor({ children }: React.PropsWithChildren<{}>) {\n  const effectiveChildren = React.Children.toArray(children);\n\n  return (\n    <Fragment>\n      {effectiveChildren.map((child, index) => (\n        <Fragment key={index}>\n          {child}\n          {index < effectiveChildren.length - 2 ? \", \" : index < effectiveChildren.length - 1 ? \" and \" : \"\"}\n        </Fragment>\n      ))}\n    </Fragment>\n  );\n}\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M686.861 340.206C691.368 340.206 694.898 338.647 697.437 335.524C699.982 332.379 701.252 328.025 701.252 322.455C701.252 316.772 699.982 312.321 697.437 309.106C694.898 305.891 691.37 304.284 686.861 304.284C682.374 304.284 678.861 305.891 676.318 309.106C673.778 312.321 672.503 316.772 672.503 322.455C672.503 328.025 673.762 332.379 676.279 335.524C678.824 338.648 682.352 340.206 686.861 340.206ZM686.861 349.33C679.087 349.33 672.912 346.916 668.329 342.092C663.751 337.271 661.46 330.75 661.46 322.524C661.46 314.137 663.751 307.486 668.329 302.573C672.912 297.632 679.087 295.164 686.861 295.164C694.678 295.164 700.869 297.632 705.425 302.573C710.008 307.486 712.294 314.137 712.294 322.524C712.294 330.75 710.008 337.271 705.425 342.092C700.869 346.916 694.678 349.33 686.861 349.33ZM630.193 347.933V305.682H614.215V296.564H657.214V305.682H641.236V347.933H630.193ZM607.923 328.572C607.945 335.911 606.277 341.212 602.92 344.47C599.585 347.711 594.141 349.33 586.588 349.33C579.342 349.33 573.968 347.641 570.466 344.259C566.992 340.861 565.237 335.63 565.217 328.572V296.563H576.261V328.922C576.261 332.605 577.111 335.363 578.816 337.202C580.543 339.046 583.136 339.965 586.59 339.965C590.281 339.965 592.922 339.127 594.503 337.448C596.084 335.751 596.881 332.906 596.881 328.923V296.563H607.926V328.572H607.923ZM531.899 347.933V305.682H515.922V296.564H558.915V305.682H542.943V347.933H531.899ZM499.155 347.933V296.563H510.204V347.931H499.155V347.933ZM466.416 347.933V305.682H450.439V296.564H493.437V305.682H477.46V347.933H466.416ZM434.467 311.972C434.274 309.526 433.171 307.595 431.153 306.171C429.141 304.73 426.516 304.004 423.277 304.004C420.469 304.004 418.275 304.611 416.693 305.821C415.107 307.009 414.316 308.675 414.316 310.821C414.316 312.358 415.144 313.546 416.801 314.386C418.431 315.224 421.895 316.213 427.199 317.353C434.898 319.031 440.04 320.966 442.633 323.154C445.226 325.32 446.517 328.804 446.517 333.605C446.517 338.428 444.564 342.261 440.654 345.1C436.743 347.923 431.455 349.331 424.789 349.331C418.098 349.331 412.869 347.825 409.102 344.821C405.332 341.815 403.32 337.542 403.057 331.999H413.707C413.826 334.724 414.842 336.822 416.763 338.289C418.683 339.756 421.358 340.488 424.789 340.488C428.313 340.488 431.062 339.945 433.026 338.849C435.016 337.732 436.01 336.193 436.01 334.236C436.01 332.301 435.307 330.88 433.891 329.972C432.499 329.064 429.524 328.117 424.967 327.138C416.569 325.322 410.959 323.354 408.129 321.235C405.321 319.139 403.917 315.865 403.917 311.413C403.917 306.429 405.778 302.483 409.496 299.57C413.213 296.634 418.237 295.167 424.569 295.167C430.498 295.167 435.318 296.684 439.035 299.71C442.751 302.737 444.817 306.827 445.226 311.973H434.467V311.972ZM362.329 347.933H352V296.563H363.588L384.815 332.588V296.563H395.138V347.931H384.132L362.329 310.921V347.933ZM331.203 347.933V296.563H342.252V347.931H331.203\",\n  fill: \"#7F7F7F\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M937.634 380.694L930.619 401.349H944.687L937.634 380.694ZM912.664 420.639L931.374 369.271H944.183L962.93 420.639H951.197L947.635 410.188H927.559L924.068 420.639H912.664ZM908.35 402.64C907.678 408.58 905.279 413.301 901.151 416.795C897.051 420.29 891.824 422.038 885.464 422.038C878.03 422.038 872.118 419.624 867.728 414.801C863.36 409.978 861.176 403.458 861.176 395.232C861.176 386.844 863.36 380.194 867.728 375.281C872.118 370.34 878.029 367.872 885.464 367.872C891.747 367.872 896.955 369.522 901.081 372.834C905.207 376.119 907.628 380.581 908.348 386.215H897.266C896.905 383.446 895.669 381.243 893.56 379.613C891.473 377.978 888.811 377.168 885.572 377.168C881.472 377.168 878.256 378.764 875.932 381.953C873.603 385.125 872.441 389.528 872.441 395.163C872.441 400.662 873.592 404.974 875.894 408.093C878.219 411.195 881.446 412.743 885.572 412.743C888.811 412.743 891.473 411.835 893.56 410.018C895.669 408.202 896.907 405.745 897.266 402.643H908.35V402.64ZM842.219 420.639V369.271H853.264V420.639H842.219ZM809.475 420.639V378.389H793.503V369.271H836.496V378.389H820.524V420.639H809.475ZM761.41 364.028L768.355 353.647H779.651L768.855 364.028H761.41ZM765.654 380.694L758.639 401.349H772.707L765.654 380.694ZM740.682 420.639L759.392 369.271H772.201L790.948 420.639H779.22L775.654 410.188H755.578L752.092 420.639H740.682ZM693.155 420.639H682.831V369.271H699.018L708.664 409.978L718.163 369.271H734.135V420.639H723.812V377.447L713.914 420.639H703.052L693.153 376.5V420.639H693.155ZM641.167 391.704H653.976C656.827 391.704 658.963 391.145 660.377 390.026C661.819 388.881 662.539 387.172 662.539 384.887C662.539 382.629 661.851 380.942 660.485 379.823C659.145 378.678 657.117 378.108 654.406 378.108H641.167V391.704ZM630.119 420.639V369.271H656.779C661.819 369.271 665.871 370.588 668.942 373.216C672.035 375.829 673.584 379.275 673.584 383.561C673.584 388.501 671.868 392.114 668.436 394.392C667.527 395 666.494 395.511 665.343 395.931C665.994 396.189 666.58 396.469 667.107 396.769C670.13 398.517 671.701 401.451 671.82 405.573L672.073 413.999C672.121 415.676 672.299 416.864 672.612 417.563C672.924 418.262 673.526 418.82 674.414 419.241V420.601H662.214C661.929 420.068 661.676 418.923 661.461 417.176C661.246 415.408 661.122 413.51 661.1 411.483L661.029 406.73C660.98 404.424 660.27 402.779 658.904 401.801C657.558 400.822 655.316 400.333 652.173 400.333H641.167V420.639H630.119ZM595.868 412.914C600.375 412.914 603.905 411.355 606.45 408.232C608.989 405.087 610.264 400.733 610.264 395.163C610.264 389.48 608.989 385.029 606.45 381.814C603.905 378.599 600.376 376.992 595.868 376.992C591.381 376.992 587.868 378.599 585.33 381.814C582.785 385.029 581.515 389.48 581.515 395.163C581.515 400.733 582.774 405.087 585.291 408.232C587.836 411.355 591.359 412.914 595.868 412.914ZM595.868 422.036C588.099 422.036 581.919 419.622 577.341 414.8C572.758 409.977 570.466 403.456 570.466 395.23C570.466 386.843 572.758 380.193 577.341 375.279C581.919 370.339 588.099 367.871 595.868 367.871C603.69 367.871 609.876 370.339 614.432 375.279C619.015 380.193 621.306 386.843 621.306 395.23C621.306 403.456 619.015 409.977 614.432 414.8C609.875 419.624 603.688 422.036 595.868 422.036ZM527.795 420.639V369.271H565.43V378.389H538.839V390.059H562.013V398.903H538.839V420.639H527.795ZM484.334 420.639H474.006V369.271H485.594L506.822 405.296V369.271H517.145V420.639H506.139L484.336 383.629V420.639H484.334ZM453.209 420.639V369.271H464.258V420.639H453.209ZM384.454 420.639V369.271H423.386V378.389H395.499V389.291H421.368V398.136H395.499V411.517H424.606V420.641H384.454V420.639ZM342.252 411.795H351.569C356.056 411.795 359.412 410.328 361.645 407.392C363.899 404.436 365.024 400.011 365.024 394.114C365.024 388.781 363.98 384.787 361.898 382.131C359.81 379.448 356.663 378.109 352.467 378.109H342.252V411.795ZM331.203 420.639V369.271H353.835C361.102 369.271 366.622 371.339 370.387 375.491C374.174 379.637 376.073 385.706 376.073 393.696C376.073 402.501 374.104 409.201 370.172 413.792C366.261 418.356 360.515 420.642 352.936 420.642H331.203\",\n  fill: \"#7F7F7F\"\n});\n\nvar _ref4 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M565.511 458.363C565.323 455.918 564.236 453.981 562.252 452.562C560.267 451.116 557.68 450.396 554.489 450.396C551.723 450.396 549.561 450.999 548.001 452.213C546.441 453.399 545.661 455.067 545.661 457.207C545.661 458.745 546.479 459.932 548.108 460.772C549.711 461.61 553.128 462.6 558.352 463.745C565.937 465.422 571.005 467.352 573.559 469.546C576.11 471.712 577.389 475.195 577.389 479.992C577.389 484.814 575.464 488.647 571.612 491.491C567.755 494.308 562.548 495.716 555.979 495.716C549.384 495.716 544.23 494.216 540.523 491.211C536.812 488.205 534.826 483.926 534.568 478.384H545.058C545.176 481.109 546.182 483.207 548.071 484.674C549.965 486.141 552.595 486.879 555.979 486.879C559.449 486.879 562.154 486.331 564.097 485.234C566.055 484.116 567.035 482.578 567.035 480.621C567.035 478.69 566.34 477.265 564.947 476.357C563.575 475.449 560.643 474.507 556.156 473.527C547.883 471.712 542.353 469.742 539.566 467.62C536.801 465.524 535.418 462.25 535.418 457.803C535.418 452.814 537.247 448.868 540.91 445.955C544.573 443.019 549.523 441.552 555.763 441.552C561.599 441.552 566.35 443.069 570.013 446.095C573.676 449.127 575.711 453.213 576.109 458.363H565.511ZM503.233 495.717C495.648 495.717 489.617 493.309 485.152 488.486C480.71 483.664 478.487 477.137 478.487 468.917C478.487 460.53 480.806 453.879 485.437 448.961C490.069 444.025 496.331 441.552 504.223 441.552C510.555 441.552 515.768 443.117 519.856 446.234C523.966 449.358 526.366 453.571 527.055 458.884H516.134C515.849 456.647 514.574 454.69 512.31 453.012C510.04 451.314 507.532 450.463 504.795 450.463C500.065 450.463 496.365 452.082 493.696 455.318C491.027 458.533 489.694 463.006 489.694 468.736C489.694 474.564 490.969 478.999 493.518 482.053C496.095 485.08 499.851 486.596 504.795 486.596H504.757C508.964 486.596 512.25 485.011 514.612 481.844C515.908 480.048 516.867 477.941 517.485 475.516V475.414H505.22V466.57H527.055V494.284H519.787L518.723 487.645L518.088 488.483C514.425 493.306 509.459 495.714 503.198 495.714H503.233V495.717ZM439.249 465.385H451.87C454.678 465.385 456.782 464.826 458.18 463.707C459.594 462.568 460.305 460.853 460.305 458.574C460.305 456.31 459.632 454.623 458.282 453.504C456.958 452.364 454.963 451.794 452.295 451.794H439.249V465.385ZM428.367 494.319V442.95H454.635C459.594 442.95 463.592 444.267 466.615 446.902C469.659 449.51 471.187 452.954 471.187 457.246C471.187 462.181 469.498 465.794 466.12 468.079C465.221 468.681 464.205 469.196 463.07 469.616C463.705 469.869 464.286 470.148 464.808 470.454C467.782 472.202 469.332 475.136 469.45 479.26L469.697 487.678C469.746 489.355 469.923 490.544 470.23 491.243C470.537 491.942 471.128 492.501 471.999 492.921V494.286H459.988C459.703 493.748 459.455 492.608 459.24 490.862C459.029 489.088 458.911 487.19 458.885 485.162L458.814 480.409C458.766 478.103 458.072 476.464 456.723 475.486C455.399 474.507 453.193 474.019 450.094 474.019H439.249V494.319H428.367ZM383.986 494.319V442.95H421.061V452.074H394.868V463.745H417.694V472.583H394.868V494.319H383.986ZM373.281 474.96C373.302 482.298 371.662 487.6 368.354 490.863C365.067 494.1 359.703 495.717 352.264 495.717C345.124 495.717 339.832 494.028 336.378 490.652C332.956 487.249 331.23 482.019 331.203 474.96V442.95H342.085V475.31C342.085 478.992 342.925 481.751 344.602 483.595C346.309 485.434 348.858 486.353 352.264 486.353C355.901 486.353 358.498 485.515 360.058 483.837C361.618 482.139 362.398 479.294 362.398 475.311V442.952H373.281V474.96Z\",\n  fill: \"black\"\n});\n\nvar _ref5 = /*#__PURE__*/React.createElement(\"path\", {\n  className: \"logo--circle\",\n  d: \"M82.2361 311.197C82.2361 333.895 63.8278 352.291 41.1146 352.291C18.4083 352.293 0 333.895 0 311.197C0 288.505 18.4083 270.108 41.1146 270.108C63.8278 270.108 82.2361 288.505 82.2361 311.197Z\",\n  fill: \"#FF0000\"\n});\n\nvar _ref6 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M577.221 516.597H331.692V534H577.221V516.597Z\",\n  fill: \"#FF0000\"\n});\n\nvar _ref7 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M177.872 67.3363H110.86V350.567H177.872V67.3363Z\",\n  fill: \"black\"\n});\n\nvar _ref8 = /*#__PURE__*/React.createElement(\"path\", {\n  fillRule: \"evenodd\",\n  clipRule: \"evenodd\",\n  d: \"M209.718 350.567H281.54V202.303C281.54 173.917 285.015 120.812 340.854 120.812C395.584 120.812 391.91 176.971 391.91 200.105V253.829H469.014V166.133C469.014 50.4437 371.899 61.3412 367.009 61.3412C330.181 61.3412 298.877 74.0994 278.479 109.904C263.136 68.6644 231.323 65.7825 209.718 67.3418V350.567Z\",\n  fill: \"black\"\n});\n\nvar _ref9 = /*#__PURE__*/React.createElement(\"path\", {\n  fillRule: \"evenodd\",\n  clipRule: \"evenodd\",\n  d: \"M499.703 253.829H576.812V160.241H633.995V108.888H576.812V93.1954C576.812 62.6211 588.572 55.3791 633.995 60.7563V3.34438C499.913 -15.5961 499.702 68.535 499.702 93.1954V253.829H499.703Z\",\n  fill: \"black\"\n});\n\nvar _ref10 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M355.301 562.934C351.199 562.934 348.023 564.48 345.773 567.574C343.523 570.645 342.398 574.934 342.398 580.441C342.398 591.902 346.699 597.633 355.301 597.633C358.91 597.633 363.281 596.73 368.414 594.926V604.066C364.195 605.824 359.484 606.703 354.281 606.703C346.805 606.703 341.086 604.441 337.125 599.918C333.164 595.371 331.184 588.855 331.184 580.371C331.184 575.027 332.156 570.352 334.102 566.344C336.047 562.312 338.836 559.23 342.469 557.098C346.125 554.941 350.402 553.863 355.301 553.863C360.293 553.863 365.309 555.07 370.348 557.484L366.832 566.344C364.91 565.43 362.977 564.633 361.031 563.953C359.086 563.273 357.176 562.934 355.301 562.934ZM426.035 580.23C426.035 588.738 423.926 595.277 419.707 599.848C415.488 604.418 409.441 606.703 401.566 606.703C393.691 606.703 387.645 604.418 383.426 599.848C379.207 595.277 377.098 588.715 377.098 580.16C377.098 571.605 379.207 565.078 383.426 560.578C387.668 556.055 393.738 553.793 401.637 553.793C409.535 553.793 415.57 556.066 419.742 560.613C423.938 565.16 426.035 571.699 426.035 580.23ZM388.523 580.23C388.523 585.973 389.613 590.297 391.793 593.203C393.973 596.109 397.23 597.562 401.566 597.562C410.262 597.562 414.609 591.785 414.609 580.23C414.609 568.652 410.285 562.863 401.637 562.863C397.301 562.863 394.031 564.328 391.828 567.258C389.625 570.164 388.523 574.488 388.523 580.23ZM466.008 554.602H477.012L459.539 606H447.656L430.219 554.602H441.223L450.891 585.188C451.43 586.992 451.98 589.102 452.543 591.516C453.129 593.906 453.492 595.57 453.633 596.508C453.891 594.352 454.77 590.578 456.27 585.188L466.008 554.602ZM483.516 606V554.602H494.414V606H483.516ZM549.996 579.809C549.996 588.27 547.582 594.75 542.754 599.25C537.949 603.75 531 606 521.906 606H507.352V554.602H523.488C531.879 554.602 538.395 556.816 543.035 561.246C547.676 565.676 549.996 571.863 549.996 579.809ZM538.676 580.09C538.676 569.051 533.801 563.531 524.051 563.531H518.25V597H522.926C533.426 597 538.676 591.363 538.676 580.09ZM556.324 591.094V582.305H575.203V591.094H556.324ZM607.125 606H596.262V576.258L596.367 571.371L596.543 566.027C594.738 567.832 593.484 569.016 592.781 569.578L586.875 574.324L581.637 567.785L598.195 554.602H607.125V606ZM657.117 576.539C657.117 586.664 654.984 594.223 650.719 599.215C646.453 604.207 639.996 606.703 631.348 606.703C628.301 606.703 625.992 606.539 624.422 606.211V597.492C626.391 597.984 628.453 598.23 630.609 598.23C634.242 598.23 637.23 597.703 639.574 596.648C641.918 595.57 643.711 593.895 644.953 591.621C646.195 589.324 646.91 586.172 647.098 582.164H646.676C645.316 584.367 643.746 585.914 641.965 586.805C640.184 587.695 637.957 588.141 635.285 588.141C630.809 588.141 627.281 586.711 624.703 583.852C622.125 580.969 620.836 576.973 620.836 571.863C620.836 566.355 622.395 562.008 625.512 558.82C628.652 555.609 632.918 554.004 638.309 554.004C642.105 554.004 645.422 554.895 648.258 556.676C651.117 558.457 653.309 561.047 654.832 564.445C656.355 567.82 657.117 571.852 657.117 576.539ZM638.52 562.723C636.27 562.723 634.512 563.496 633.246 565.043C631.98 566.59 631.348 568.816 631.348 571.723C631.348 574.207 631.922 576.176 633.07 577.629C634.219 579.082 635.965 579.809 638.309 579.809C640.512 579.809 642.398 579.094 643.969 577.664C645.539 576.211 646.324 574.547 646.324 572.672C646.324 569.883 645.586 567.527 644.109 565.605C642.656 563.684 640.793 562.723 638.52 562.723Z\",\n  fill: \"#FF0000\"\n});\n\nvar SvgLogo = function SvgLogo(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 964,\n    height: 620,\n    viewBox: \"0 0 964 620\",\n    fill: \"none\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9, _ref10);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgLogo, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/logo.0fb68d66.svg\";\nexport { ForwardRef as ReactComponent };","import React from \"react\";\n\nimport { ReactComponent as Logo } from \"../assets/logo.svg\";\n\nimport \"./Loader.css\";\n\nexport default function Loader() {\n  return (\n    <div\n      style={{\n        height: \"100vh\",\n        background: \"#f5f5f5\",\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\"\n      }}\n    >\n      <Logo\n        className=\"Loading--logo\"\n        style={{ height: \"150px\", width: \"auto\" }}\n      />\n    </div>\n  );\n}\n","export const titleCase = (word: string) => word.slice(0, 1).toUpperCase() + word.slice(1);\n","import * as d3 from \"d3\";\nimport { format } from \"date-fns\";\nimport { first, last, sortBy, defaultTo } from \"lodash\";\nimport get from \"lodash/get\";\nimport React, { useMemo } from \"react\";\nimport ReactApexChart, { Props } from \"react-apexcharts\";\nimport { Loader } from \"semantic-ui-react\";\nimport useRegionData from \"../hooks/useRegionData\";\nimport useSeriesColors from \"../hooks/useSeriesColors\";\nimport { ChartOptions } from \"./Editor\";\nimport { getByRegionId } from \"../utils/metadata\";\nimport useMetadata from \"../hooks/useMetadata\";\nimport { titleCase } from \"../utils/string\";\n\nconst numberFormatter = d3.format(\".2s\");\n\nconst displayNumberFormatter = d3.format(\",\");\n\ntype TrendChartProps = Omit<Props, \"options\" | \"series\" | \"type\"> & Pick<ChartOptions, \"selectedRegions\" | \"title\" | \"alignAt\" | \"metric\" | \"scale\">;\n\nfunction TrendChart(props: TrendChartProps, ref: React.Ref<any>) {\n  const { selectedRegions, title, alignAt, metric, scale = \"log\", ...rest } = props;\n\n  const regionsIds = useMemo(() => {\n    return Object.keys(selectedRegions);\n  }, [selectedRegions]);\n\n  const { error, data, loading } = useRegionData(regionsIds);\n  const { data: metadata } = useMetadata();\n\n  const series = useMemo(() => {\n    if (!data || !metadata) return [];\n\n    const series = Object.entries(data).map(([regionId, regionData]) => {\n      return {\n        key: regionId,\n        name: getByRegionId(metadata, regionId).displayName,\n        data: regionData.flatMap((row, index) => {\n          const valueColumn = metric;\n          const valueDailyColumn = `${metric}_daily`;\n\n          if (row[metric] < alignAt) return [];\n\n          return [\n            {\n              date: row.date,\n              x: row[valueColumn],\n              y: defaultTo(\n                regionData.slice(Math.max(0, index - 6), index + 1).reduce((sum, r) => sum + get(r, valueDailyColumn, 0), 0),\n                0\n              ),\n            },\n          ];\n        }),\n      };\n    });\n\n    return series.filter((s) => s.data.length > 0);\n  }, [data, metadata, metric, alignAt]);\n\n  const [xScaler, yScaler, scaledSeries] = useMemo(() => {\n    let minX = Number.POSITIVE_INFINITY;\n    let minY = Number.POSITIVE_INFINITY;\n    let maxX = Number.NEGATIVE_INFINITY;\n    let maxY = Number.NEGATIVE_INFINITY;\n\n    series.forEach(({ data }) => {\n      data.forEach(({ x, y }) => {\n        minX = Math.min(x, minX);\n        maxX = Math.max(x, maxX);\n        minY = Math.min(y, minY);\n        maxY = Math.max(y, maxY);\n      });\n    });\n\n    const xScaler =\n      scale === \"log\"\n        ? d3.scaleLog().domain([Math.max(1, Math.pow(10, Math.floor(Math.log10(minX)))), Math.pow(10, Math.ceil(Math.log10(maxX)))])\n        : d3.scaleLinear().domain([0, round(maxX)]);\n    const yScaler =\n      scale === \"log\"\n        ? d3.scaleLog().domain([Math.max(1, Math.pow(10, Math.floor(Math.log10(minY)))), Math.pow(10, Math.ceil(Math.log10(maxY)))])\n        : d3.scaleLinear().domain([0, round(maxY)]);\n\n    const scaledSeries = series.map((series) => ({\n      ...series,\n      data: series.data.map((item) => ({\n        ...item,\n        x: xScaler(item.x),\n        y: defaultTo(yScaler(item.y), 0),\n      })),\n    }));\n\n    return [xScaler, yScaler, scaledSeries];\n  }, [series, scale]);\n\n  const sortedSeries = useMemo(() => {\n    return sortBy(scaledSeries, \"name\");\n  }, [scaledSeries]);\n\n  const seriesColors = useSeriesColors(sortedSeries);\n\n  const chartOptions = useMemo(() => {\n    const xTicks = xScaler.ticks();\n    const yTicks = yScaler.ticks();\n\n    const xTickAmount = Math.log10(last(xTicks)!) - Math.log10(first(xTicks)!);\n    const yTickAmount = Math.log10(last(yTicks)!) - Math.log10(first(yTicks)!);\n\n    const withXScaler = (fn: (...args: any) => {}) => (n: number, ...args: any) => fn(Math.round(xScaler.invert(n)), ...args);\n    const withYScaler = (fn: (...args: any) => {}) => (n: number, ...args: any) => fn(Math.round(yScaler.invert(n)), ...args);\n\n    return {\n      chart: {\n        fontFamily: \"Lato, 'Helvetica Neue', Arial, Helvetica, sans-serif\",\n        animations: {\n          animateGradually: { enabled: false },\n        },\n        toolbar: {\n          tools: {\n            download: false,\n            selection: true,\n            zoom: true,\n            zoomin: false,\n            zoomout: false,\n            pan: false,\n            reset: true,\n          },\n        },\n        zoom: {\n          type: \"xy\",\n        },\n      },\n      grid: {\n        xaxis: {\n          lines: {\n            show: true,\n          },\n        },\n      },\n      colors: seriesColors,\n      stroke: {\n        width: 2,\n        curve: \"straight\",\n      },\n      tooltip: {\n        shared: false,\n        intersect: true,\n        y: {\n          formatter: withYScaler((n: number) => `Weekly Confirmed ${titleCase(metric)}: ${displayNumberFormatter(n)}`),\n        },\n        x: {\n          formatter: withXScaler(\n            (n: number, point: any) =>\n              `${displayNumberFormatter(n)} confirmed ${metric} at ${format(new Date(point?.w?.config?.series[point.seriesIndex].data[point.dataPointIndex].date), \"PPP\")}`\n          ),\n        },\n      },\n      legend: {\n        position: \"top\",\n      },\n      xaxis: {\n        type: \"numeric\",\n        max: 1,\n        min: 0,\n        tickAmount: scale === \"log\" ? xTickAmount : undefined,\n        labels: {\n          formatter: withXScaler((n: number) => (n < 1000 ? Math.round(n) : numberFormatter(n))),\n        },\n        title: {\n          text: `Total Confirmed ${titleCase(metric)}`,\n          offsetY: 10,\n        },\n        tooltip: {\n          enabled: false,\n        },\n      },\n      yaxis: {\n        max: 1,\n        min: 0,\n        tickAmount: scale === \"log\" ? yTickAmount : undefined,\n        axisTicks: {\n          offsetX: 5,\n        },\n        axisBorder: {\n          offsetX: 5,\n        },\n        labels: {\n          offsetX: 5,\n          formatter: withYScaler((n: number) => (n < 1000 ? Math.round(n) : numberFormatter(n))),\n        },\n        title: {\n          offsetX: 5,\n          text: `New Confirmed ${titleCase(metric)} (in the Past Week)`,\n        },\n      },\n      title: {\n        text: title,\n        style: {\n          fontSize: \"20px\",\n          fontFamily: \"Lato, 'Helvetica Neue', Arial, Helvetica, sans-serif\",\n        },\n      },\n      markers: {\n        size: 3,\n        strokeWidth: 1,\n        strokeOpacity: 0.7,\n        hover: {\n          sizeOffset: 3,\n        },\n      },\n    };\n  }, [title, metric, seriesColors, scale, xScaler, yScaler]);\n\n  if (loading) {\n    return (\n      <div style={{ height: props.height, display: \"flex\", justifyContent: \"center\", alignItems: \"center\" }}>\n        <Loader active inline />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div style={{ height: props.height, display: \"flex\", justifyContent: \"center\", alignItems: \"center\", textAlign: \"center\" }}>\n        Ooops! Something is wrong.\n        <br />\n        Please try it later or choose different regions.\n      </div>\n    );\n  }\n\n  return <ReactApexChart ref={ref} options={chartOptions} series={sortedSeries} type=\"line\" height={rest.height} width={rest.width} />;\n}\n\nexport default React.forwardRef(TrendChart);\n\nconst round = (n: number) => {\n  let factor = 5;\n  for (let x = 5; x * 2 <= n; x *= 10) {\n    factor = x;\n  }\n  return Math.ceil(n / factor) * factor;\n};\n","import { subHours } from \"date-fns\";\nimport { useMemo } from \"react\";\nimport { useQuery } from \"react-query\";\nimport { get } from \"lodash\";\n\nconst defaultLastUpdated = subHours(new Date(), 2).toISOString();\n\nconst fetchRepo = async () => {\n  const response = await fetch(\"https://api.github.com/repos/inf-covid19/data/branches/master\");\n  const data = await response.json();\n\n  return get(data, \"commit.commit.author.date\", defaultLastUpdated);\n};\n\nexport default function useLastUpdated() {\n  const { data = defaultLastUpdated } = useQuery(\"last-updated\", fetchRepo);\n\n  return useMemo(() => {\n    return new Date(data);\n  }, [data]);\n}\n","import * as d3 from \"d3\";\nimport { addDays, eachDayOfInterval, format, startOfDay, subDays } from \"date-fns\";\nimport get from \"lodash/get\";\nimport last from \"lodash/last\";\nimport sortBy from \"lodash/sortBy\";\nimport PolynomialRegression from \"ml-regression-polynomial\";\nimport numeral from \"numeral\";\nimport React, { useMemo } from \"react\";\nimport ReactApexChart, { Props } from \"react-apexcharts\";\nimport { Loader } from \"semantic-ui-react\";\nimport useMetadata from \"../hooks/useMetadata\";\nimport useRegionData from \"../hooks/useRegionData\";\nimport useSeriesColors from \"../hooks/useSeriesColors\";\nimport { getByRegionId } from \"../utils/metadata\";\nimport { alignTimeseries } from \"../utils/normalizeTimeseries\";\nimport { ChartOptions } from \"./Editor\";\nimport useColorScale from \"../hooks/useColorScale\";\nimport { isNumber } from \"lodash\";\nimport { titleCase } from \"../utils/string\";\n\nconst displayNumberFormatter = d3.format(\",.2~f\");\nconst ordinalFormattter = (n: number) => numeral(n).format(\"Oo\");\nconst numberFormatter = d3.format(\".2~s\");\n\ntype PredictionsChartProps = Omit<Props, \"options\" | \"series\" | \"type\"> & ChartOptions;\n\nfunction PredictionsChart(props: PredictionsChartProps, ref: React.Ref<any>) {\n  const { chartType = \"line\", title, metric, showDataLabels, isCumulative, dayInterval, selectedRegions, alignAt = 0, predictionDays, ...rest } = props;\n\n  const regionsIds = useMemo(() => Object.keys(selectedRegions), [selectedRegions]);\n\n  const { data, loading, error } = useRegionData(regionsIds);\n  const { data: metadata } = useMetadata();\n\n  const series = useMemo(() => {\n    if (!data || !metadata) {\n      return [];\n    }\n\n    return Object.entries(data).map(([key, data]) => {\n      return {\n        name: getByRegionId(metadata, key).displayName,\n        key,\n        data,\n      };\n    });\n  }, [data, metadata]);\n\n  const filteredSeries = useMemo(() => {\n    return series.filter((s) => !!selectedRegions[s.key]);\n  }, [series, selectedRegions]);\n\n  const seriesWithPredictions = useMemo(() => {\n    return filteredSeries.flatMap((serie) => {\n      const dataSinceFirstCase = serie.data.filter((d) => d.cases > 0);\n      const getNextSeriesPrediction = () => {\n        const { X, Y } = dataSinceFirstCase.slice(-Math.max(dayInterval, 2)).reduce<{ X: number[]; Y: number[] }>(\n          (acc, row, index) => {\n            return {\n              X: [...acc.X, index],\n              Y: [...acc.Y, metric === \"cases\" ? row.cases : row.deaths],\n            };\n          },\n          { X: [], Y: [] }\n        );\n\n        const degree = X.length > 2 ? 2 : 1;\n        const regression = new PolynomialRegression(X, Y, degree);\n        const pred = (n: number) => Math.round(regression.predict(n));\n        const lastDate = last(dataSinceFirstCase)!.date;\n        const predictionSerie = eachDayOfInterval({\n          start: lastDate,\n          end: addDays(lastDate, predictionDays),\n        });\n        const fActual = last(Y)!;\n        const fPrediction = pred(X.length - 1);\n        const F = Math.max(fPrediction, 0) === 0 ? 1 : fActual / fPrediction;\n\n        const Ka = dataSinceFirstCase.filter((x) => x.cases > 300).length;\n        const K = Math.max(0, 360 - Ka);\n\n        return predictionSerie.slice(1).reduce<any[]>((arr, date, index) => {\n          const Ki = K === 0 ? 0 : Math.max(0, (K - index) / K);\n          const predValue = pred(X.length + index) * F * Ki;\n          const lastMetric = (arr[index - 1] || last(dataSinceFirstCase))[metric] as number;\n\n          arr.push({\n            date: date,\n            [metric]: Math.round(Math.max(predValue, lastMetric)),\n            isPrediction: true,\n          });\n          return arr;\n        }, []);\n      };\n\n      const serieData = alignTimeseries(dataSinceFirstCase, subDays(startOfDay(new Date()), dayInterval));\n      if (dataSinceFirstCase.length <= 2) {\n        return [\n          {\n            ...serie,\n            data: serieData.map((row) => ({\n              x: row.date.getTime(),\n              y: row[metric],\n              isPrediction: false,\n            })),\n          },\n        ];\n      }\n\n      const nextSeriePredictions = getNextSeriesPrediction();\n\n      return [\n        {\n          ...serie,\n          data: serieData.concat(nextSeriePredictions).map((row: any) => ({\n            x: row.date.getTime(),\n            y: row[metric],\n            isPrediction: row.isPrediction || false,\n          })),\n        },\n      ];\n    });\n  }, [dayInterval, filteredSeries, metric, predictionDays]);\n\n  const sortedSeries = useMemo(() => {\n    return sortBy(seriesWithPredictions, chartType === \"heatmap\" ? (s) => get(s.data, [s.data.length - 1, \"y\"], 0) : \"name\");\n  }, [chartType, seriesWithPredictions]);\n\n  const [predictionX1, predictionX2] = useMemo(() => {\n    let x1 = startOfDay(new Date()).getTime();\n    let x2 = addDays(startOfDay(new Date()), predictionDays).getTime();\n\n    sortedSeries.forEach(({ data }) => {\n      const predictions = data.filter((d) => d.isPrediction);\n\n      x1 = Math.min(x1, ...predictions.map((d) => d.x));\n      x2 = Math.max(x2, ...predictions.map((d) => d.x));\n    });\n\n    return [x1, x2];\n  }, [sortedSeries, predictionDays]);\n\n  const seriesColors = useSeriesColors(sortedSeries);\n\n  const colorScale = useColorScale(sortedSeries);\n\n  const chartOptions = useMemo(() => {\n    return {\n      chart: {\n        fontFamily: \"Lato, 'Helvetica Neue', Arial, Helvetica, sans-serif\",\n        animations: {\n          animateGradually: { enabled: false },\n        },\n        toolbar: {\n          tools: {\n            download: false,\n            selection: false,\n            zoom: false,\n            zoomin: false,\n            zoomout: false,\n            pan: false,\n            reset: false,\n          },\n        },\n      },\n      colors: seriesColors,\n      tooltip: {\n        y: {\n          formatter: (value: number, point: any) => {\n            const pointData = point?.w?.config?.series[point.seriesIndex].data[point.dataPointIndex];\n            return `${displayNumberFormatter(value)} ${metric}${pointData && pointData.isPrediction ? \" (Prediction)\" : \"\"}`;\n          },\n        },\n        x: {\n          formatter:\n            alignAt > 0\n              ? (value: number) => `${ordinalFormattter(value)} day after ${alignAt >= 1000 ? numberFormatter(alignAt) : alignAt} ${metric}`\n              : (date: number) => `${format(new Date(date), \"PPP\")}`,\n        },\n      },\n      yaxis: {\n        axisTicks: {\n          offsetX: 5,\n        },\n        axisBorder: {\n          offsetX: 5,\n        },\n        labels: {\n          offsetX: 5,\n          formatter: (value: number | string) => (isNumber(value) ? (value < 1 ? displayNumberFormatter(value) : numberFormatter(value)) : value),\n        },\n        title: {\n          offsetX: 5,\n          text: chartType === \"heatmap\" ? undefined : `${isCumulative ? \"Total\" : \"Daily\"} Confirmed ${titleCase(metric)}`,\n        },\n      },\n      xaxis: {\n        type: alignAt === 0 ? \"datetime\" : \"numeric\",\n        labels: {\n          formatter: alignAt > 0 ? ordinalFormattter : undefined,\n        },\n      },\n      annotations: {\n        xaxis: [\n          {\n            x: predictionX1,\n            x2: predictionX2,\n            fillColor: \"#0000FF\",\n            opacity: chartType === \"heatmap\" ? 0.0 : 0.1,\n            label: {\n              text: \"Prediction\",\n            },\n          },\n        ],\n      },\n      dataLabels: {\n        enabled: showDataLabels,\n        formatter: (n: number) => (n >= 1000 ? numberFormatter(n) : n),\n      },\n      title: {\n        text: title,\n        style: {\n          fontSize: \"20px\",\n          fontFamily: \"Lato, 'Helvetica Neue', Arial, Helvetica, sans-serif\",\n        },\n      },\n      plotOptions: {\n        heatmap: {\n          colorScale,\n        },\n      },\n    };\n  }, [seriesColors, alignAt, predictionX1, predictionX2, chartType, showDataLabels, title, isCumulative, metric, colorScale]);\n\n  if (loading) {\n    return (\n      <div style={{ height: props.height, display: \"flex\", justifyContent: \"center\", alignItems: \"center\" }}>\n        <Loader active inline />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div style={{ height: props.height, display: \"flex\", justifyContent: \"center\", alignItems: \"center\", textAlign: \"center\" }}>\n        Ooops! Something is wrong.\n        <br />\n        Please try it later or choose different regions.\n      </div>\n    );\n  }\n\n  return (\n    <ReactApexChart\n      key={chartType}\n      ref={ref}\n      options={chartOptions}\n      series={sortedSeries}\n      type={chartType}\n      height={Math.max(Number(rest.height), (chartType === \"heatmap\" ? 30 : 0) * sortedSeries.length)}\n      width={rest.width}\n    />\n  );\n}\n\nexport default React.forwardRef(PredictionsChart);\n","import { Matrix } from \"ml-matrix\";\nimport * as ml from \"ml-distance\";\nimport * as d3 from \"d3\";\n\nconst makeMatrix = (m: number[][]) => {\n  const matrix = new Matrix(m);\n\n  const max = matrix.max();\n  const min = matrix.min();\n  const scaleFn = d3.scaleLinear().range([0, 1]).domain([min, max]);\n\n  matrix.apply((i, j) => matrix.set(i, j, scaleFn(matrix.get(i, j))));\n\n  return matrix;\n};\n\nconst getDistance = (a: number[], b: number[]) => {\n  const distanceFn = ml.distance.euclidean;\n  return distanceFn(a, b);\n};\n\n// Learn more: https://en.wikipedia.org/wiki/Sammon_mapping\nexport function getSammonStress(raw: number[][], projection: number[][]) {\n  let scale = 0;\n  let stress = 0;\n\n  const rawMatrix = makeMatrix(raw);\n  const projectionMatrix = makeMatrix(projection);\n\n  const length = rawMatrix.rows;\n  for (let i = 0; i < length - 1; i++) {\n    for (let j = i + 1; j < length; j++) {\n      const dOriginal = getDistance(rawMatrix.getRow(i), rawMatrix.getRow(j));\n      if (dOriginal > 0) {\n        const dProjection = getDistance(projectionMatrix.getRow(i), projectionMatrix.getRow(j));\n        scale += dOriginal;\n        stress += Math.pow(dOriginal - dProjection, 2) / dOriginal;\n      }\n    }\n  }\n\n  return (1 / scale) * stress;\n}\n","import * as d3 from \"d3\";\nimport { format } from \"date-fns\";\nimport first from \"lodash/first\";\nimport last from \"lodash/last\";\nimport sortBy from \"lodash/sortBy\";\nimport React, { useMemo } from \"react\";\nimport ReactApexChart, { Props } from \"react-apexcharts\";\nimport { Loader } from \"semantic-ui-react\";\nimport TSNE from \"tsne-js\";\nimport { UMAP } from \"umap-js\";\nimport useMetadata from \"../hooks/useMetadata\";\nimport useRegionData from \"../hooks/useRegionData\";\nimport useSeriesColors from \"../hooks/useSeriesColors\";\nimport { median } from \"../utils/math\";\nimport { getByRegionId } from \"../utils/metadata\";\nimport { ChartOptions } from \"./Editor\";\nimport { getSammonStress } from \"../utils/sammonStress\";\n\nconst numberFormatter = d3.format(\".2s\");\n\ntype ProjectionsChartProps = Omit<Props, \"options\" | \"series\" | \"type\"> & ChartOptions;\n\nfunction ProjectionsChart(props: ProjectionsChartProps, ref: React.Ref<any>) {\n  const {\n    title,\n    metric,\n    showDataLabels,\n    isCumulative,\n    selectedRegions,\n    alignAt,\n    epsilon,\n    iterations,\n    perplexity,\n    timeserieSlice,\n    projectionType,\n    spread,\n    minDist,\n    neighbors,\n    chartType,\n    ...rest\n  } = props;\n\n  const regionsIds = useMemo(() => Object.keys(selectedRegions), [selectedRegions]);\n\n  const { data, loading, error } = useRegionData(regionsIds);\n  const { data: metadata } = useMetadata();\n\n  const series = useMemo(() => {\n    if (loading || !data || !metadata) {\n      return [];\n    }\n\n    return Object.entries(data).flatMap(([region, regionData]) => {\n      const { displayName } = getByRegionId(metadata, region);\n      const regionDataWithValues = regionData.filter((v) => v[metric] > 0);\n\n      if (regionDataWithValues.length === 0) {\n        return [];\n      }\n\n      const startDate = first(regionDataWithValues)!.date;\n      const { date: endDate, cases, deaths } = last(regionDataWithValues)!;\n      const avg = median(regionDataWithValues.map((v) => v[`${metric}_daily` as \"cases_daily\" | \"deaths_daily\"]));\n\n      return [\n        {\n          name: displayName,\n          key: region,\n          startDate,\n          endDate,\n          cases,\n          deaths,\n          avg,\n          data: regionData\n            .filter((v) => v[metric] >= alignAt)\n            .map((v, index) => ({\n              x: index + 1,\n              y: isCumulative ? v[metric] : v[`${metric}_daily` as \"cases_daily\" | \"deaths_daily\"],\n            })),\n        },\n      ];\n    });\n  }, [loading, data, metadata, metric, alignAt, isCumulative]);\n\n  const sortedSeries = useMemo(() => {\n    return sortBy(series, \"name\");\n  }, [series]);\n\n  const [projectionSeries, sammonStress] = useMemo(() => {\n    const validSeries = sortedSeries.filter((series) => series.data.length >= (timeserieSlice || 0));\n    const projectionData = validSeries.map((series) => series.data.slice(0, timeserieSlice).map((cord) => cord.y));\n\n    if (projectionData.length === 0) {\n      return [[], 0];\n    }\n\n    let projectionOutput: number[][] = [];\n\n    switch (projectionType) {\n      case \"tsne\": {\n        const model = new TSNE({\n          dim: 2,\n          earlyExaggeration: 4.0,\n          perplexity: perplexity,\n          learningRate: epsilon,\n          nIter: iterations,\n          metric: \"euclidean\",\n        });\n        model.init({\n          data: projectionData,\n          type: \"dense\",\n        });\n\n        projectionOutput = model.getOutput();\n        break;\n      }\n      case \"umap\": {\n        if (projectionData.length <= neighbors) {\n          return [[], 0];\n        }\n\n        const umap = new UMAP({\n          nComponents: 2,\n          nNeighbors: neighbors,\n          spread: spread,\n          minDist: minDist,\n        });\n        const embedding = umap.fit(projectionData);\n\n        projectionOutput = embedding;\n        break;\n      }\n    }\n\n    const sammonStress = getSammonStress(projectionData, projectionOutput);\n\n    return [\n      validSeries.map((serie, index) => {\n        return {\n          ...serie,\n          data: [\n            {\n              x: projectionOutput[index][0],\n              y: projectionOutput[index][1],\n            },\n          ],\n        };\n      }),\n      sammonStress,\n    ];\n  }, [epsilon, iterations, minDist, neighbors, perplexity, projectionType, sortedSeries, spread, timeserieSlice]);\n\n  const seriesColors = useSeriesColors(projectionSeries);\n\n  const chartOptions = useMemo(() => {\n    return {\n      chart: {\n        fontFamily: \"Lato, 'Helvetica Neue', Arial, Helvetica, sans-serif\",\n        zoom: {\n          enabled: true,\n          type: \"xy\",\n        },\n        animations: {\n          animateGradually: { enabled: false },\n        },\n        toolbar: {\n          tools: {\n            download: false,\n            selection: false,\n            pan: false,\n            zoom: true,\n            zoomin: true,\n            zoomout: true,\n            reset: true,\n          },\n        },\n      },\n      xaxis: {\n        type: \"numeric\",\n        labels: {\n          show: false,\n        },\n        tooltip: {\n          enabled: false,\n        },\n      },\n      yaxis: {\n        labels: {\n          show: false,\n        },\n      },\n      colors: seriesColors,\n      tooltip: {\n        y: {\n          formatter: (_: number, point: any) => {\n            const seriesData = projectionSeries[point.seriesIndex];\n            const total = seriesData?.[metric];\n\n            return total >= 0 ? `${total} ${metric}` : \"-\";\n          },\n        },\n        x: {\n          formatter: (_: number, point: any) => {\n            const seriesData = projectionSeries[point.seriesIndex];\n\n            if (seriesData?.startDate && seriesData?.endDate) {\n              return `From ${format(new Date(seriesData.startDate), \"PPP\")} to ${format(new Date(seriesData.endDate), \"PPP\")}`;\n            }\n\n            if (seriesData?.startDate) {\n              return `Since ${format(new Date(seriesData.startDate), \"PPP\")}`;\n            }\n\n            if (seriesData?.endDate) {\n              return `Until ${format(new Date(seriesData.endDate), \"PPP\")}`;\n            }\n\n            return `No eligible data`;\n          },\n        },\n      },\n      dataLabels: {\n        enabled: showDataLabels,\n        formatter: (n: number) => (n >= 1000 ? numberFormatter(n) : n),\n      },\n      title: {\n        text: title,\n        style: {\n          fontSize: \"20px\",\n          fontFamily: \"Lato, 'Helvetica Neue', Arial, Helvetica, sans-serif\",\n        },\n      },\n      subtitle: {\n        text: `Projection based on the ${isCumulative ? \"total\" : \"daily\"} number of ${metric} | Sammon’s stress: ${sammonStress.toFixed(4)}`,\n        floating: true,\n        style: {\n          fontSize: \"14px\",\n          fontFamily: \"Lato, 'Helvetica Neue', Arial, Helvetica, sans-serif\",\n        },\n      },\n      markers: {\n        strokeWidth: 1,\n        strokeColors: \"#909090\",\n        hover: {\n          sizeOffset: 5,\n        },\n      },\n      grid: {\n        strokeDashArray: 7,\n        xaxis: {\n          lines: {\n            show: true,\n          },\n        },\n        yaxis: {\n          lines: {\n            show: true,\n          },\n        },\n      },\n    };\n  }, [seriesColors, showDataLabels, title, isCumulative, metric, sammonStress, projectionSeries]);\n\n  if (loading) {\n    return (\n      <div style={{ height: props.height, display: \"flex\", justifyContent: \"center\", alignItems: \"center\" }}>\n        <Loader active inline />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div style={{ height: props.height, display: \"flex\", justifyContent: \"center\", alignItems: \"center\", textAlign: \"center\" }}>\n        Ooops! Something is wrong.\n        <br />\n        Please try it later or choose different regions.\n      </div>\n    );\n  }\n  return <ReactApexChart ref={ref} options={chartOptions} series={projectionSeries} type=\"scatter\" height={rest.height} width={rest.width} />;\n}\n\nexport default React.forwardRef(ProjectionsChart);\n","export const median = (raw: number[]) => {\n  const arr = [...raw].sort();\n  const mid = Math.floor(arr.length / 2);\n  return arr.length % 2 !== 0 ? arr[mid] : (arr[mid - 1] + arr[mid]) / 2;\n};\n","import { useLocation, useHistory } from \"react-router-dom\";\nimport queryString from \"query-string\";\nimport { useCallback, useMemo } from \"react\";\n\nfunction useQueryString() {\n  const history = useHistory();\n  const { search } = useLocation();\n\n  const params = useMemo(() => queryString.parse(search), [search]);\n\n  const setParams = useCallback(\n    (nextParams: queryString.ParsedQuery) => {\n      const search = queryString.stringify({ ...params, ...nextParams });\n\n      history.push({\n        search,\n      });\n    },\n    [params, history]\n  );\n\n  return [params, setParams] as const;\n}\n\nexport default useQueryString;\n","import { csv, format } from \"d3\";\nimport { groupBy, keyBy, orderBy, castArray, defaultTo } from \"lodash\";\nimport first from \"lodash/first\";\nimport React, { useCallback, useEffect, useMemo } from \"react\";\nimport { queryCache, useQuery } from \"react-query\";\nimport { generatePath, useHistory, useParams } from \"react-router-dom\";\nimport { Dropdown, Flag, Grid, Header, Icon, List, Loader, Popup, Segment, Statistic, SemanticICONS } from \"semantic-ui-react\";\nimport { DEFAULT_OPTIONS, SIMILARITY_API } from \"../../constants\";\nimport useMetadata from \"../../hooks/useMetadata\";\nimport { getByRegionId } from \"../../utils/metadata\";\nimport CustomizableChart from \"../CustomizableChart\";\nimport RegionSelector from \"../RegionSelector\";\nimport TrendChart from \"../TrendChart\";\nimport useQueryString from \"../../hooks/useQueryString\";\n\nimport \"./Explorer.css\";\nimport useRegionData from \"../../hooks/useRegionData\";\nimport { differenceInDays } from \"date-fns\";\n\nconst displayNumberFormatter = format(\",.2~f\");\n\nconst similarityOptions = [\n  {\n    key: \"cases_distance\",\n    text: \"cases\",\n    value: \"cases_distance\",\n    content: \"Cases\",\n  },\n  {\n    key: \"deaths_distance\",\n    text: \"deaths\",\n    value: \"deaths_distance\",\n    content: \"Deaths\",\n  },\n  {\n    key: \"cases_per_100k_distance\",\n    text: \"cases per 100k inhab.\",\n    value: \"cases_per_100k_distance\",\n    content: \"Cases per 100k inhab.\",\n  },\n  {\n    key: \"deaths_per_100k_distance\",\n    text: \"deaths per 100k inhab.\",\n    value: \"deaths_per_100k_distance\",\n    content: \"Deaths per 100k inhab.\",\n  },\n];\n\nconst Explorer = () => {\n  const history = useHistory();\n  const { region: regionKey } = useParams<{ region?: string }>();\n  const [query, setQuery] = useQueryString();\n\n  const region = useMemo(() => (regionKey ? { [regionKey]: true } : {}), [regionKey]);\n\n  const aspect = useMemo(() => similarityOptions.find((opt) => opt.value === query.aspect)?.value ?? 'cases_per_100k_distance', [query.aspect]);\n\n  const secondary = useMemo(() => `${first(castArray(defaultTo(query.secondary, \"\")))}`, [query.secondary]);\n\n  const setSecondary = (value: string) => {\n    setQuery({\n      secondary: value,\n    });\n  };\n\n  const setAspect = (value: string) => {\n    setQuery({\n      aspect: value,\n      secondary: \"\",\n    });\n  };\n\n  const setSelectedRegions = useCallback(\n    (regions) => {\n      history.push({\n        pathname: generatePath(\"/similarity/:region?\", {\n          region: first(Object.keys(regions)) || undefined,\n        }),\n      });\n    },\n    [history]\n  );\n\n  const { data: metadata } = useMetadata();\n\n  const { data } = useQuery(\"region-clustering\", () => csv(`${SIMILARITY_API}/api/v1/regions`));\n\n  const [dataByKey, dataByCluster] = useMemo(() => {\n    if (!data || !metadata) return [{}, {}];\n\n    const parsedData = data.flatMap((item) => {\n      const parsedItem = {\n        key: item.key!,\n        area_km: parseFloat(item.area_km || \"0\"),\n        cluster: item.cluster || \"\",\n        days: parseInt(item.days || \"0\"),\n        population: parseFloat(item.population || \"0\"),\n        population_density: parseFloat(item.population_density || \"0\"),\n        ...getByRegionId(metadata, item.key!),\n      };\n\n      if (parsedItem.days <= 0) {\n        return [];\n      }\n\n      return parsedItem;\n    });\n\n    return [keyBy(parsedData, \"key\"), groupBy(parsedData, \"cluster\")];\n  }, [data, metadata]);\n\n  const regionFilter = useCallback((key) => !!dataByKey[key], [dataByKey]);\n\n  const currentRegion = useMemo(() => {\n    const selectedKey = first(Object.keys(region));\n    return selectedKey ? dataByKey[selectedKey] : null;\n  }, [region, dataByKey]);\n\n  const { data: topSimilarData, status: topSimilarDataStatus } = useQuery([\"region-similar\", currentRegion?.key], () =>\n    currentRegion ? csv(`${SIMILARITY_API}/api/v1/regions/${currentRegion.key}`) : Promise.resolve(null)\n  );\n\n  useEffect(() => {\n    if (topSimilarDataStatus === \"success\" && topSimilarData?.length === 0) {\n      const timer = setInterval(() => queryCache.refetchQueries([\"region-similar\", currentRegion?.key], { force: true }), 5000);\n      return () => {\n        clearInterval(timer);\n      };\n    }\n  }, [currentRegion, data, topSimilarData, topSimilarDataStatus]);\n\n  const isIncidence = [\"cases_per_100k_distance\", \"deaths_per_100k_distance\"].includes(aspect);\n\n  const sortedTopSimilar = useMemo(() => {\n    if (!topSimilarData || !currentRegion) return [];\n\n    const { days } = currentRegion;\n    const maxValue = Math.max(...topSimilarData.map((i) => Number(i[aspect] ?? 0)));\n\n    return orderBy(\n      topSimilarData,\n      (item) => {\n        const region = dataByKey[item.region!];\n\n        if (!region) {\n          console.warn(\"Region not found.\", { key: item.region });\n          return 0;\n        }\n\n        const similarity = 1 - Number(item[aspect] ?? 0) / maxValue;\n        const daysFactor = Math.min(1, region.days / days);\n        return similarity * daysFactor;\n      },\n      \"desc\"\n    );\n  }, [aspect, currentRegion, dataByKey, topSimilarData]);\n\n  const clusterBuddies = useMemo(() => {\n    if (!currentRegion || !topSimilarData) return [];\n\n    return orderBy(dataByCluster[currentRegion.cluster], (item) => dataByKey[item.key]?.displayName);\n  }, [currentRegion, dataByCluster, dataByKey, topSimilarData]);\n\n  const secondaryRegion = useMemo(() => {\n    if (sortedTopSimilar && !(secondary in dataByKey)) {\n      return dataByKey[first(sortedTopSimilar)?.region!];\n    }\n    return secondary ? dataByKey[secondary] : null;\n  }, [dataByKey, secondary, sortedTopSimilar]);\n\n  const chartRegions = useMemo(() => {\n    if (!currentRegion || !secondaryRegion) {\n      return {};\n    }\n\n    return { [currentRegion.key]: true, [secondaryRegion.key]: true };\n  }, [currentRegion, secondaryRegion]);\n\n  const regionIds = useMemo(() => {\n    if (!currentRegion || !secondaryRegion) {\n      return [];\n    }\n    return [currentRegion.key, secondaryRegion.key];\n  }, [currentRegion, secondaryRegion]);\n\n  const { data: regionData } = useRegionData(regionIds);\n\n  const timelineStats = useMemo(() => {\n    const stats: Record<string, { sinceFirstCase: number; sinceFirstDeath: number }> = {};\n\n    if (!regionData || Object.keys(regionData).length < 2) {\n      return undefined;\n    }\n\n    Object.entries(regionData).forEach(([key, timeline]) => {\n      const firstCase = timeline.find((row) => row.cases > 0);\n      const firstDeath = timeline.find((row) => row.deaths > 0);\n\n      stats[key] = {\n        sinceFirstCase: firstCase ? differenceInDays(new Date(), firstCase.date) : 0,\n        sinceFirstDeath: firstDeath ? differenceInDays(new Date(), firstDeath.date) : 0,\n      };\n    });\n\n    return stats;\n  }, [regionData]);\n\n  if (!data || !metadata) {\n    return (\n      <div style={{ height: \"350px\", display: \"flex\", justifyContent: \"center\", alignItems: \"center\" }}>\n        <Loader active inline />\n      </div>\n    );\n  }\n\n  const regionSelector = (\n    <div style={{ width: \"100%\", maxWidth: \"350px\", margin: \"0 auto\" }}>\n      <RegionSelector value={region} onChange={setSelectedRegions} multiple={false} filter={regionFilter} />\n    </div>\n  );\n\n  if (!currentRegion) {\n    return (\n      <div style={{ padding: \"0 20px\" }}>\n        <Segment placeholder>\n          <Header icon>\n            <Icon name=\"search\" />\n            Find Region\n          </Header>\n          {regionSelector}\n        </Segment>\n      </div>\n    );\n  }\n\n  return (\n    <div style={{ padding: \"0 20px\" }}>\n      {regionSelector}\n\n      {timelineStats && topSimilarData && topSimilarData.length > 0 && secondaryRegion ? (\n        <div style={{ display: \"grid\", gridTemplateColumns: \"450px 1fr\" }}>\n          <div style={{ padding: 10 }}>\n            <Segment>\n              <Header as=\"h3\">\n                <div className=\"header--dropdown\">\n                  Top-similar by{\" \"}\n                  <Dropdown\n                    style={{ fontWeight: 700 }}\n                    className=\"large\"\n                    button\n                    basic\n                    compact\n                    onChange={(_: any, { value }: any) => setAspect(value)}\n                    options={similarityOptions}\n                    value={aspect}\n                  />\n                </div>\n                <Header.Subheader>Regions with similar epidemiological timeline</Header.Subheader>\n              </Header>\n              <div style={{ maxHeight: \"250px\", overflow: \"auto\" }}>\n                <List relaxed>\n                  {sortedTopSimilar?.slice(0, 99).map((r, idx) => (\n                    <List.Item\n                      href=\"#\"\n                      onClick={(evt) => {\n                        evt.preventDefault();\n                        setSecondary(r.region!);\n                      }}\n                      key={r.region}\n                    >\n                      <div>\n                        <span style={{ display: \"inline-block\", opacity: 0.8, color: \"rgba(0,0,0,.87)\", width: \"20px\", marginRight: 5 }}>{idx + 1}</span>\n                        <Flag name={dataByKey[r.region!].flag} />\n                        {dataByKey[r.region!].displayName}\n                        {r.is_same_cluster === \"True\" && (\n                          <>\n                            {\" \"}\n                            <Popup\n                              basic\n                              inverted\n                              trigger={<Icon name=\"star\" color=\"yellow\" />}\n                              content={`${dataByKey[r.region!].displayName} has similar attributes when compared with ${currentRegion.displayName}`}\n                            />\n                          </>\n                        )}\n                      </div>\n                    </List.Item>\n                  ))}\n                </List>\n              </div>\n\n              <Header as=\"h3\">\n                Cluster\n                <Header.Subheader>Regions with similar population and area</Header.Subheader>\n              </Header>\n              <div style={{ maxHeight: \"250px\", overflow: \"auto\" }}>\n                <List relaxed>\n                  {clusterBuddies.map((r) =>\n                    r.key === currentRegion?.key ? (\n                      <List.Item key={r.key}>\n                        <Flag name={r.flag} />\n                        {r.displayName}\n                      </List.Item>\n                    ) : (\n                      <List.Item\n                        href=\"#\"\n                        onClick={(evt) => {\n                          evt.preventDefault();\n                          setSecondary(r.key);\n                        }}\n                        key={r.key}\n                      >\n                        <Flag name={r.flag} />\n                        {r.displayName}\n                      </List.Item>\n                    )\n                  )}\n                </List>\n              </div>\n            </Segment>\n          </div>\n\n          <div style={{ padding: 10 }}>\n            <Segment>\n              <Grid columns={2}>\n                <Grid.Column>\n                  <Header as=\"h3\">\n                    <Flag name={currentRegion.flag} /> {currentRegion.displayName}\n                  </Header>\n                  <Statistic.Group horizontal>\n                    <Statistic>\n                      <Statistic.Value>{displayNumberFormatter(currentRegion.population)}</Statistic.Value>\n                      <Statistic.Label>Population</Statistic.Label>\n                    </Statistic>\n                    <Statistic>\n                      <Statistic.Value>{displayNumberFormatter(currentRegion.area_km)}</Statistic.Value>\n                      <Statistic.Label>km²</Statistic.Label>\n                    </Statistic>\n                    <Statistic>\n                      <Statistic.Value>{displayNumberFormatter(currentRegion.population_density)}</Statistic.Value>\n                      <Statistic.Label>inhab/km²</Statistic.Label>\n                    </Statistic>\n                    <Statistic>\n                      <Statistic.Value>{timelineStats[currentRegion.key]?.sinceFirstCase}</Statistic.Value>\n                      <Statistic.Label>Days since first case</Statistic.Label>\n                    </Statistic>\n                    <Statistic>\n                      <Statistic.Value>{timelineStats[currentRegion.key]?.sinceFirstDeath}</Statistic.Value>\n                      <Statistic.Label>Days since first death</Statistic.Label>\n                    </Statistic>\n                  </Statistic.Group>\n                </Grid.Column>\n                <Grid.Column>\n                  <Header as=\"h3\">\n                    <Flag name={secondaryRegion.flag} />\n                    {secondaryRegion?.displayName}\n                  </Header>\n                  <Statistic.Group horizontal>\n                    <Statistic>\n                      <Statistic.Value>\n                        <DiffIndicator primaryValue={currentRegion.population} secondaryValue={secondaryRegion.population} /> {displayNumberFormatter(secondaryRegion.population)}\n                      </Statistic.Value>\n                      <Statistic.Label>Population</Statistic.Label>\n                    </Statistic>\n                    <Statistic>\n                      <Statistic.Value>\n                        <DiffIndicator primaryValue={currentRegion.area_km} secondaryValue={secondaryRegion.area_km} /> {displayNumberFormatter(secondaryRegion.area_km)}\n                      </Statistic.Value>\n                      <Statistic.Label>km²</Statistic.Label>\n                    </Statistic>\n                    <Statistic>\n                      <Statistic.Value>\n                        <DiffIndicator primaryValue={currentRegion.population_density} secondaryValue={secondaryRegion.population_density} />{\" \"}\n                        {displayNumberFormatter(secondaryRegion.population_density)}\n                      </Statistic.Value>\n                      <Statistic.Label>inhab/km²</Statistic.Label>\n                    </Statistic>\n                    <Statistic>\n                      <Statistic.Value>\n                        <DiffIndicator primaryValue={timelineStats[currentRegion.key]?.sinceFirstCase} secondaryValue={timelineStats[secondaryRegion.key]?.sinceFirstCase} />{\" \"}\n                        {timelineStats[secondaryRegion.key]?.sinceFirstCase}\n                      </Statistic.Value>\n                      <Statistic.Label>Days since first case</Statistic.Label>\n                    </Statistic>\n                    <Statistic>\n                      <Statistic.Value>\n                        <DiffIndicator primaryValue={timelineStats[currentRegion.key]?.sinceFirstDeath} secondaryValue={timelineStats[secondaryRegion.key]?.sinceFirstDeath} />{\" \"}\n                        {timelineStats[secondaryRegion.key]?.sinceFirstDeath}\n                      </Statistic.Value>\n                      <Statistic.Label>Days since first death</Statistic.Label>\n                    </Statistic>\n                  </Statistic.Group>\n                </Grid.Column>\n              </Grid>\n            </Segment>\n            <Segment>\n              <CustomizableChart\n                {...DEFAULT_OPTIONS}\n                selectedRegions={chartRegions}\n                alignAt={1}\n                chartType=\"bar\"\n                isCumulative={true}\n                height={250}\n                metric={\"cases\"}\n                title={`Total Cases - Comparison between ${currentRegion?.displayName} and ${secondaryRegion?.displayName}`}\n                timeserieSlice={-1}\n                isIncidence={isIncidence}\n                getPopulation={(key) => dataByKey[key].population}\n              />\n            </Segment>\n            <Segment>\n              <CustomizableChart\n                {...DEFAULT_OPTIONS}\n                selectedRegions={chartRegions}\n                alignAt={1}\n                chartType=\"bar\"\n                isCumulative={true}\n                height={250}\n                metric={\"deaths\"}\n                title={`Total Deaths - Comparison between ${currentRegion?.displayName} and ${secondaryRegion?.displayName}`}\n                timeserieSlice={-1}\n                isIncidence={isIncidence}\n                getPopulation={(key) => dataByKey[key].population}\n              />\n            </Segment>\n            <Segment>\n              <Header as=\"h3\">\n                Trend comparison between {currentRegion?.displayName} and {secondaryRegion?.displayName}\n              </Header>\n              <Grid columns={2}>\n                <Grid.Column>\n                  <TrendChart {...DEFAULT_OPTIONS} selectedRegions={chartRegions} alignAt={1} height={250} metric={\"cases\"} title={``} />\n                </Grid.Column>\n                <Grid.Column>\n                  <TrendChart {...DEFAULT_OPTIONS} selectedRegions={chartRegions} alignAt={1} height={250} metric={\"deaths\"} title={``} />\n                </Grid.Column>\n              </Grid>\n            </Segment>\n          </div>\n        </div>\n      ) : (\n        <div style={{ height: \"350px\", display: \"flex\", justifyContent: \"center\", alignItems: \"center\" }}>\n          <Loader active inline>\n            Processing latest data...\n          </Loader>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Explorer;\n\nfunction DiffIndicator({ primaryValue, secondaryValue }: { primaryValue: number; secondaryValue: number }) {\n  if (primaryValue === secondaryValue) {\n    return <Icon name=\"minus\" color=\"grey\" />;\n  }\n\n  const diff = primaryValue - secondaryValue;\n  const isHugeDiff = Math.abs(diff) > secondaryValue || Math.abs(diff) > primaryValue;\n\n  return <Icon name={`angle ${isHugeDiff ? \"double \" : \"\"}${diff > 0 ? \"down\" : \"up\"}` as SemanticICONS} color={diff > 0 ? \"red\" : \"green\"} />;\n}\n","import * as fns from \"date-fns\";\nimport React, { useEffect, useMemo } from \"react\";\nimport { Container, Header, Menu, Label } from \"semantic-ui-react\";\nimport \"./App.css\";\nimport LogoINF from \"./assets/ufrgs-inf.png\";\nimport LogoUFRGS from \"./assets/ufrgs.png\";\nimport ChartEditor from \"./components/ChartEditor\";\nimport ListDescriptor from \"./components/ListDescriptor\";\nimport Loader from \"./components/Loader\";\nimport TrendEditor from \"./components/TrendEditor\";\nimport { DATA_SOURCES } from \"./constants\";\nimport useLastUpdated from \"./hooks/useLastUpdated\";\nimport useMetadata from \"./hooks/useMetadata\";\nimport PredictionsEditor from \"./components/PredictionsEditor\";\nimport ProjectionsEditor from \"./components/ProjectionsEditor\";\nimport SimilarityExplorer from \"./components/Similarity/Explorer\";\nimport { Switch, Route, Link, generatePath, useLocation, Redirect } from \"react-router-dom\";\nimport ReactGA from \"react-ga\";\n\nconst LAST_TAB_KEY = \"covid19-tools.api.lastTab\";\n\nconst MENU_ITEMS = [\n  {\n    name: \"Chart Editor\",\n    path: \"/editor\",\n    component: ChartEditor,\n  },\n  {\n    name: \"Trend Visualizer\",\n    path: \"/trends\",\n    component: TrendEditor,\n  },\n  {\n    name: \"Prediction Visualizer\",\n    path: \"/predictions\",\n    component: PredictionsEditor,\n  },\n  {\n    name: \"Projection Visualizer\",\n    path: \"/projections\",\n    component: ProjectionsEditor,\n    isBeta: false,\n  },\n  {\n    name: \"Similarity Explorer\",\n    path: \"/similarity/:region?\",\n    component: SimilarityExplorer,\n    isBeta: false,\n  },\n];\n\nfunction App() {\n  const lastUpdated = useLastUpdated();\n  const lastLocation = useMemo(() => localStorage.getItem(LAST_TAB_KEY) || MENU_ITEMS[0].path, []);\n\n  const { loading } = useMetadata();\n\n  const location = useLocation();\n\n  useEffect(() => {\n    localStorage.setItem(LAST_TAB_KEY, location.pathname);\n    ReactGA.pageview(location.pathname);\n  }, [location]);\n\n  if (loading) {\n    return <Loader />;\n  }\n\n  return (\n    <div>\n      <header className=\"App--header\">\n        <img src={LogoUFRGS} height=\"100\" alt=\"Universidade Federal do Rio Grande do Sul (UFRGS)\" />{\" \"}\n        <div style={{ margin: \"0 2em\" }}>\n          <Header as=\"h1\">\n            COVID-19 Analysis Tools\n            <Header.Subheader>A set of configurable tools around COVID-19 data.</Header.Subheader>\n          </Header>\n        </div>\n        <img src={LogoINF} height=\"100\" alt=\"Instituto de Informática UFGRS\" />\n      </header>\n\n      <Container fluid>\n        <Menu className=\"App--menu\" pointing secondary>\n          {MENU_ITEMS.map((item) => (\n            <Route key={item.name} path={item.path}>\n              {({ match }) => (\n                <Menu.Item as={Link} to={generatePath(item.path)} name={item.name} active={!!match}>\n                  {item.name}\n                  {item.isBeta && <Label color=\"teal\">Beta</Label>}\n                </Menu.Item>\n              )}\n            </Route>\n          ))}\n        </Menu>\n\n        <Switch>\n          {MENU_ITEMS.map((item) => (\n            <Route key={item.name} path={item.path} component={item.component} />\n          ))}\n          <Route path=\"*\">\n            <Redirect to={lastLocation} />\n          </Route>\n        </Switch>\n      </Container>\n\n      <footer className=\"App--footer\">\n        <span>\n          Sources:{\" \"}\n          <ListDescriptor>\n            {DATA_SOURCES.map((src) => (\n              <a key={src.url} rel=\"noopener noreferrer\" target=\"_blank\" href={src.url}>\n                {src.name}\n              </a>\n            ))}\n          </ListDescriptor>\n          . Last updated at {fns.format(lastUpdated, \"PPpp\")}.\n        </span>\n      </footer>\n    </div>\n  );\n}\nexport default App;\n","import React from \"react\";\nimport TrendChart from \"./TrendChart\";\nimport Editor from \"./Editor\";\n\nexport default function TrendEditor() {\n  return (\n    <Editor\n      id=\"trends\"\n      availableOptions={[\"metric\", \"alignAt\", \"title\", \"selectedRegions\", \"scale\"]}\n      render={(ref, options) => {\n        return <TrendChart ref={ref} {...options} height={600} />;\n      }}\n    />\n  );\n}\n","import React from \"react\";\nimport Editor from \"./Editor\";\nimport PredictionsChart from \"./PredictionsChart\";\n\nexport default function PredictionsEditor() {\n  return (\n    <Editor\n      id=\"predictions\"\n      isPredictionChart={true}\n      availableOptions={[\"chartType\", \"metric\", \"showDataLabels\", \"title\", \"dayInterval\", \"selectedRegions\", \"predictionDays\"]}\n      render={(ref, options) => {\n        return <PredictionsChart ref={ref} {...options} height={600} />;\n      }}\n    />\n  );\n}\n","import React, { Fragment } from \"react\";\nimport Editor from \"./Editor\";\nimport ProjectionsChart from \"./ProjectionsChart\";\nimport CustomizableChart from \"./CustomizableChart\";\n\nexport default function ProjectionsEditor() {\n  return (\n    <Editor\n      id=\"projections\"\n      availableOptions={[\n        \"epsilon\",\n        \"projectionType\",\n        \"chartType\",\n        \"spread\",\n        \"neighbors\",\n        \"minDist\",\n        \"perplexity\",\n        \"iterations\",\n        \"timeserieSlice\",\n        \"metric\",\n        \"isCumulative\",\n        \"alignAt\",\n        \"title\",\n        \"selectedRegions\",\n        \"showDataLabels\",\n      ]}\n      render={(ref, options) => {\n        return (\n          <Fragment>\n            <ProjectionsChart ref={ref} {...options} alignAt={options.alignAt || 1} showDataLabels={false} height={350} />\n            <CustomizableChart\n              {...options}\n              alignAt={options.alignAt || 1}\n              height={Math.max(350, (options.chartType === \"heatmap\" ? 20 : 0) * Object.keys(options.selectedRegions).length)}\n            />\n          </Fragment>\n        );\n      }}\n    />\n  );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport ReactGA from \"react-ga\";\nimport { ReactQueryConfigProvider } from \"react-query\";\nimport { BrowserRouter as Router, Route } from \"react-router-dom\";\nimport { QueryParamProvider } from \"use-query-params\";\n\nif (process.env.NODE_ENV === \"production\") {\n  ReactGA.initialize(process.env.REACT_APP_GA_TRACKING_CODE!);\n}\n\nconst queryConfig = { refetchAllOnWindowFocus: false };\n\nReactDOM.render(\n  <React.StrictMode>\n    <ReactQueryConfigProvider config={queryConfig}>\n      <Router basename={process.env.REACT_APP_BASENAME}>\n        <QueryParamProvider ReactRouterRoute={Route}>\n          <App />\n        </QueryParamProvider>\n      </Router>\n    </ReactQueryConfigProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}